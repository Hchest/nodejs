
### 字典速查

手术名称(YXA_O_151)
	SSMC	1	胰十二指肠切除术
	SSMC	2	胰十二指肠切除术（联合门静脉壁切除）
	SSMC	3	胰十二指肠切除术（保留幽门）
	SSMC	4	胰体尾脾切除术
	SSMC	12	根治性顺行模块胰体尾脾切除术
	SSMC	5	胰体尾切除术（保脾）
	SSMC	6	全胰切除术
	SSMC	7	保留十二指肠的胰头肿物切除术
	SSMC	8	胰腺节段切除术
	SSMC	13	探查术
	SSMC	14	活检术
	SSMC	15	胰腺肿物剜除术
手术方式(YXA_O_152)
	SSFS	1	完全腹腔镜
	SSFS	2	腔镜转开腹
	SSFS	3	完全开腹
	SSFS	4	机器人辅助
	SSFS	5	纳米刀辅助
	SSFS	6	离子植入术

### CPDC 待更新数据

```SQL
-- 删除胰漏分级为空和0的数据
DELETE [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_181' AND SD_ITEM_VALUE='0'
DELETE [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_181' AND SD_ITEM_VALUE=''
-- 删除病理诊断结果为 胰腺导管腺癌
DELETE [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_230' AND SD_ITEM_VALUE='胰腺导管腺癌'
-- 删除 胰腺残端切缘
DELETE [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_226' AND SD_ITEM_VALUE='甚近'
-- 手术名称是单选
SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_151' AND SD_ITEM_VALUE='全胰切除'
UPDATE [dbo].[PAT_SD_ITEM_RESULT] SET SD_ITEM_VALUE='18' WHERE SD_ITEM_CODE='YXA_O_151' AND SD_ITEM_VALUE='全胰切除'
-- 待处理，肿瘤长宽高不是数值的情况
SELECT * FROM (
	SELECT
		PATIENT_NO,
		SD_ITEM_VALUE,
		PATINDEX('%[^0-9|.]%', SD_ITEM_VALUE) AS isNumber -- 大于0 ，说明不是数值类型
	-- 	MAX ( CONVERT(NUMERIC,SD_ITEM_VALUE) ) AS 'tmax' 
	FROM
		[dbo].[PAT_SD_ITEM_RESULT] 
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_212', 'YXA_O_213', 'YXA_O_214' ) 
		AND SD_ITEM_VALUE != ''
) AS tmax WHERE tmax.isNumber>0
-- 查看数据类型是单选或者多选，但值是文本的数据
SELECT
	* 
FROM
	[dbo].[PAT_SD_ITEM_RESULT] 
WHERE
	SD_CODE = 'YXA_O' 
	AND SD_ITEM_CODE IN ( SELECT ITEM_CODE FROM [dbo].[SD_ITEM_DICT] WHERE SD_CODE = 'YXA_O' AND ITEM_FORMAT IN ( '5', '6' ) )
	AND SD_ITEM_VALUE LIKE '%[吖-座]%'
```


### 2019年11月11统计

瑞金： 'bdf2906bc6d18a8d'

三年上报总病例数： 11198
瑞金三年上报总病例数： 1074

38家三年机器人： 339
瑞金三年机器人： 237

手术日期： YXA_O_161

一年死亡的: 1986
一年死亡的: 1384
一年内没死亡： 6463
所有有随访的患者： 7847

<!-- 按年 ( DATEDIFF 按年不准确 ) -->
所有有死亡日期的患者数为： 2763
一年内死亡的： 658 + 院内死亡 91
两年内死亡的： 1479
三年内死亡的： 562
四年内死亡的： 61

<!-- 按月 -->
所有有死亡日期的患者数为： 2563 新：2656
一年内死亡的： 1342 + 院内死亡 91 = 1433
两年内死亡的： 914
三年内死亡的： 176
四年内死亡的： 8
一年内未死亡的： 4087

死亡日期不为空的患者数： 2656
```sql
-- 一年内死亡的患者
	SELECT-- *
	a.PATIENT_NO,
	a.SD_ITEM_CODE,
	CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ) AS '手术日期',
	b.SD_ITEM_CODE,
	CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 ) AS '随访死亡日期',
		DATEDIFF(
			mm,
			CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
			CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
		)
	FROM
		[dbo].[PAT_SD_ITEM_RESULT] AS a
		LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期
		AND b.SD_ITEM_VALUE != ''
	WHERE
		a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期
		AND a.SD_ITEM_CODE!= ''
		AND b.PATIENT_NO= a.PATIENT_NO
		AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		AND DATEDIFF(
			mm,
			CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
			CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
		) <= '12'
		AND DATEDIFF(
				mm,
				CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
				CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
			) > '0'
	ORDER BY
		a.PATIENT_NO
```

```sql
-- 下面是手术日期错误的数据更新
	SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO='9ee6d5baec6ad451' AND SD_ITEM_CODE='YXA_O_161'

	UPDATE [dbo].[PAT_SD_ITEM_RESULT] SET SD_ITEM_VALUE='2017-06-21' WHERE PATIENT_NO='9ee6d5baec6ad451' AND SD_ITEM_CODE='YXA_O_161'

	-- 手术日期
	SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO='d63099debd1ecaf7' AND SD_ITEM_CODE='YXA_O_161'
	-- 更新手术日期
	UPDATE [dbo].[PAT_SD_ITEM_RESULT] SET SD_ITEM_VALUE='2017-05-09' WHERE PATIENT_NO='d63099debd1ecaf7' AND SD_ITEM_CODE='YXA_O_161'
	-- 随访死亡日期
	SELECT * FROM [dbo].[PAT_FOLLOW_UP_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_257' AND PATIENT_NO='ef4d8f9f4e07cd3d'
	-- 更新随访死亡日期
	UPDATE [dbo].[PAT_FOLLOW_UP_RESULT] SET SD_ITEM_VALUE='2018/03/12' WHERE SD_ITEM_CODE = 'YXA_O_257' AND PATIENT_NO='ef4d8f9f4e07cd3d'
	SELECT * FROM [dbo].[PAT_FOLLOW_UP_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_257' AND PATIENT_NO='f33acfe826ab55a8'

	UPDATE [dbo].[PAT_FOLLOW_UP_RESULT] SET SD_ITEM_VALUE='2019/3/1' WHERE SD_ITEM_CODE = 'YXA_O_257' AND PATIENT_NO='f33acfe826ab55a8'
```
1. 随访一年以上的患者 2930
```sql
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		AND FOLLOW_UP_MONTHS >= 12 -- 大于等于12个月
	GROUP BY
		PATIENT_NO
```

2. 收集胰腺癌根治术后12个月内死亡患者
	胰腺癌根治术 =
	1 胰十二指肠切除术 +
	2 胰十二指肠切除术（联合门静脉壁切除）+
	3 胰十二指肠切除术（保留幽门）+
	12 根治性顺行模块胰体尾脾切除术
	= 704

```sql
	SELECT
	DISTINCT a.PATIENT_NO
	-- a.PATIENT_NO,
	-- a.SD_ITEM_CODE,
	-- CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ) AS '手术日期',
	-- b.SD_ITEM_CODE,
	-- CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 ) AS '随访死亡日期',
	-- DATEDIFF(
	-- 	mm,
	-- 	CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
	-- 	CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
	-- )
	FROM
		[dbo].[PAT_SD_ITEM_RESULT] AS a
		LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

		AND b.SD_ITEM_VALUE != ''
	WHERE
		a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

		AND a.SD_ITEM_CODE!= ''
		AND b.PATIENT_NO= a.PATIENT_NO
		AND a.PATIENT_NO IN (
		SELECT
			PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
		WHERE
			SD_ITEM_CODE = 'YXA_O_151'
			AND ( SD_ITEM_VALUE = '1' OR SD_ITEM_VALUE = '2' OR SD_ITEM_VALUE = '3' OR SD_ITEM_VALUE = '12' )
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		)
		AND DATEDIFF(
			mm,
			CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
			CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
		) <= '12'
		AND DATEDIFF(
			mm,
			CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
		CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
		) >= '0'
		ORDER BY a.PATIENT_NO
```
```sql
--- 胰腺癌根治术存活超过一年的(2237)
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
		AND FOLLOW_UP_MONTHS > 12 -- 超过12个月
		AND PATIENT_NO IN (
		-- 根治术
			SELECT
				PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT]
			WHERE
				SD_ITEM_CODE = 'YXA_O_151'
				AND ( SD_ITEM_VALUE = '1' OR SD_ITEM_VALUE = '2' OR SD_ITEM_VALUE = '3' OR SD_ITEM_VALUE = '12' )
				AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
			)
		AND PATIENT_NO NOT IN (
		-- 排除一年内死亡的患者
			SELECT
				DISTINCT a.PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT] AS a
				LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期
				AND b.SD_ITEM_VALUE != ''
			WHERE
				a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期
				AND a.SD_ITEM_CODE!= ''
				AND b.PATIENT_NO= a.PATIENT_NO
				AND DATEDIFF(
					mm,
					CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
					CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
				) <= '12'
				AND DATEDIFF(
					mm,
					CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
				CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
				) >= '0'
		)
	GROUP BY PATIENT_NO
```

3. 胰十二指肠切除术，胰十二指肠切除术（联合门静脉壁切除），胰十二指肠切除术（保留幽门）的患者,各有多少？
	 胰十二指肠切除术： 6172
	 胰十二指肠切除术（联合门静脉壁切除）： 330
	 胰十二指肠切除术（保留幽门）： 365
```sql
-- 胰十二指肠切除术： 6172
	SELECT
		*
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_CODE = 'YXA_O'
		AND SD_ITEM_CODE = 'YXA_O_151'
		AND SD_ITEM_VALUE = '1'
		AND PATIENT_NO IN (SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O')
```

4. 胰十二指肠切除术的病例，分别使用腹腔镜或开腹的，各有多少？
	胰十二指肠切除术中完全腹腔镜的有： 612
	胰十二指肠切除术中完全开腹的有： 5148
```sql
-- 胰十二指肠切除术中完全开腹的有： 5148
	SELECT
		*
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_CODE = 'YXA_O'
		AND SD_ITEM_CODE = 'YXA_O_152'
		AND SD_ITEM_VALUE = '3'
		AND PATIENT_NO IN (
		SELECT
			PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
		WHERE
			SD_CODE = 'YXA_O'
			AND SD_ITEM_CODE = 'YXA_O_151'
		AND SD_ITEM_VALUE = '1'
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' ))
```


### 2019年11月12日

1. 去掉不可切除 且 去掉术前放化疗 且 去掉围手术期(30天内)死亡的 151

YXA_O	YXA_O_149	术前可切除性评估 SQKQCXPG
YXA	SQKQCXPG	1	可切除
YXA	SQKQCXPG	2	不可切除
YXA_O	YXA_O_117	是否放化疗 2


术后一年内有肿瘤复发或转移的患者有多少？ 1231
	有复发日期的总数 1852
	有转移日期的总数 2257
```sql
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
		AND FOLLOW_UP_MONTHS <= 12 -- 超过12个月
		AND PATIENT_NO IN (SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP_RESULT]
	WHERE
		SD_ITEM_VALUE != ''
		AND (
		SD_ITEM_CODE = 'YXA_O_251'
		OR SD_ITEM_CODE = 'YXA_O_254')
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' ) )
	GROUP BY
		PATIENT_NO
```
术后一年内无肿瘤复发或转移的患者有多少？ 2532
```sql
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
		AND FOLLOW_UP_MONTHS <= 12 -- 一年内
		AND PATIENT_NO IN (SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP_RESULT]
	WHERE
		SD_ITEM_VALUE = '2'
		AND (
		SD_ITEM_CODE = 'YXA_O_250'
		OR SD_ITEM_CODE = 'YXA_O_253')
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )  )
	GROUP BY
		PATIENT_NO
```
有至少一次随访中做了胰十二指肠切除术，胰十二指肠切除术（联合门静脉壁切除），胰十二指肠切除术（保留幽门）的患者有多少？ 4282
```sql
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
	-- 	AND FOLLOW_UP_MONTHS <= 12 -- 一年内
		AND PATIENT_NO IN ( SELECT
			DISTINCT PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
		WHERE
			SD_CODE = 'YXA_O'
			AND SD_ITEM_CODE = 'YXA_O_151'
			AND (SD_ITEM_VALUE = '1' OR SD_ITEM_VALUE = '2' OR SD_ITEM_VALUE = '3')
			AND PATIENT_NO IN (SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O') )
	GROUP BY
		PATIENT_NO
```



TODO:

1. 有至少一次随访资料（7306）人，完整度；
2. 所有死亡患者（2529）人，加上随访1年以上的（3930）人，完整度

下载全部死亡的 2529 下载三年有死亡时间的病例



### 2019年11月27统计

第一个：

```SQL
-- 分别列出 TNM 分期 的值

	-- T：取值
	-- N：N0:LN阳性个数为0； N1:LN阳性个数1-3； N2:LN阳性个数≥4
	-- M: 取值 （是对应1，否对应0）

	-- 分期规则：
	-- IA: T1/N0/M0
	-- IB: T2/N0/M0
	-- IIA: T3/N0/M0
	-- IIB: T1-T3, N1,M0
	-- III: 1.任何T、N2、M0；2.T4、任何N、M0
	-- IV: 任何T、任何N、M1

	SELECT
		ret.PATIENT_NO,
		ret.T,
		ret.N,
		ret.M,
		(CASE
			WHEN ret.T='1' AND ret.N='0' AND ret.M='0' THEN 'IA'
			WHEN ret.T='2' AND ret.N='0' AND ret.M='0' THEN 'IB'
			WHEN ret.T='3' AND ret.N='0' AND ret.M='0' THEN 'IIA'
			WHEN ret.T IN ('1','2','3') AND ret.N='1' AND ret.M='0' THEN 'IIB'
			WHEN ret.M='0' THEN 'III'
			WHEN ret.M='1' THEN 'IV'
			ELSE NULL
		END
		) AS '分期'
	FROM (

		SELECT
			a.PATIENT_NO,
				( SELECT SD_ITEM_VALUE FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_220' ) AS 'T',

				( SELECT (CASE
							WHEN SD_ITEM_VALUE <= '0' THEN '0'
							WHEN SD_ITEM_VALUE IN ('1','2','3') THEN '1'
							WHEN SD_ITEM_VALUE >= '4' THEN '2'
							ELSE NULL
						END)
					FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_222' ) AS 'N',

				( SELECT (CASE SD_ITEM_VALUE
								WHEN '1' THEN '1'
								WHEN '2' THEN '0'
								ELSE NULL
							END)
					FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_224' ) AS 'M'

			FROM [dbo].[PAT_VISIT] AS a
			WHERE a.SD_CODE= 'YXA_O' AND a.SD_GROUP= '1'

	) AS ret
	WHERE ret.T!='' AND ret.N!='' AND ret.M!=''
```


第二个重要工作。计算“有死亡终点”，“有病情进展”终点的两类患者数量，这些患者需要以下数据项有记录：

a 血管侵犯：“术后病理”章节的“脉管侵犯”字段 YXA_O_217
b 淋巴结转移：“术后病理”章节的“N:LN阳性个数” YXA_O_222
c 神经浸润：“术后病理”章节的“围神经浸润” YXA_O_218
d 肿瘤分化程度：“术后病理”章节的“分化” YXA_O_211
e TNM分期
f 新辅助治疗：“术前治疗”章节的“是否放化疗”选择“是”，且“化疗药物有名称，或者放疗剂量有数值”。 'YXA_O_118','YXA_O_119'
g 术后辅助治疗：“后续计划治疗方案”章节的“是否化疗”选择“是”，且“化疗药物有名称，或者放疗剂量有数值” 'YXA_O_301','YXA_O_303'
h  手术方式 YXA_O_152
i 肝转移：“增强CT/MRI”章节“肝转移”字段 YXA_O_056

```SQL
-- 查询有死亡终点而且有以下数据项的患者
	SELECT DISTINCT
		PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_118', 'YXA_O_119', 'YXA_O_301', 'YXA_O_303', 'YXA_O_217', 'YXA_O_222', 'YXA_O_218', 'YXA_O_211', 'YXA_O_152', 'YXA_O_056','YXA_O_220','YXA_O_222','YXA_O_224')
		AND SD_ITEM_VALUE != ''
		AND PATIENT_NO IN (SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP_RESULT]
	WHERE
		SD_ITEM_CODE = 'YXA_O_257'
		AND SD_ITEM_VALUE != ''
		AND PATIENT_NO IN (SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O'))
```
```SQL
-- 查询有病情进展而且有以下数据项的患者
	SELECT DISTINCT
		PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_118', 'YXA_O_119', 'YXA_O_301', 'YXA_O_303', 'YXA_O_217', 'YXA_O_222', 'YXA_O_218', 'YXA_O_211', 'YXA_O_152', 'YXA_O_056','YXA_O_220','YXA_O_222','YXA_O_224')
		AND SD_ITEM_VALUE != ''
		AND PATIENT_NO IN (SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE = 'YXA_O_920'
		AND SD_ITEM_VALUE ='1'
		AND PATIENT_NO IN (SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O'))
```

这两组患者是所有有至少一次随访记录的患者，包括死亡的，没死亡的
	1.胰十二指肠切除术+腹腔镜 287
	2.胰十二指肠切除术+完全开腹术 3724
	其中，“胰十二指肠切除术”包括“胰十二指肠切除术”“胰十二指肠切除术（联合门静脉壁切除）”及“胰十二指肠切除术（保留幽门）”三种术式。


=LEFT(D2,MIN(FIND({"省","市","区"},D2&"省市区")))

=IF(A1>30,"肥胖",IF(A1>25,"超重",IF(A1<25,"正常")))



### 近期的三项专家研究

请协助计算几个数据，然后提交专家：
1.金佳斌研究：请计算各字段的完整率（文件）
2.杨尹默院长研究1
	a.符合以下条件的病例数量：有随访记录（8853）+ 有复发或转移记录（1505） + 有围手术期药物治疗的（3707）- 围手术期死亡（158）-术后意外死亡（3）= 831
```SQL
	SELECT
		DISTINCT PATIENT_NO
	FROM (

		-- 有复发转移（也有随访）记录的 YXA_O_921
		SELECT DISTINCT
			PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
			WHERE
				SD_ITEM_CODE = 'YXA_O_921'
				AND SD_ITEM_VALUE = '1'
				AND PATIENT_NO IN (

				-- 有围手术期治疗（术前，术后治疗）
				SELECT
					DISTINCT PATIENT_NO
				FROM [dbo].[PAT_SD_ITEM_RESULT]
					WHERE SD_ITEM_CODE IN ( 'YXA_O_117', 'YXA_O_134', 'YXA_O_300' )
					AND SD_ITEM_VALUE = '1'
					AND PATIENT_NO IN (

							-- 有随访记录
							SELECT DISTINCT PATIENT_NO FROM [dbo].[PAT_FOLLOW_UP]
						)
				)

		) AS list
	WHERE
	PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O')

	AND PATIENT_NO NOT IN (

			-- 院内死亡
			SELECT DISTINCT
				a.PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT] AS a
			WHERE
				a.SD_ITEM_CODE = 'YXA_O_209'
				AND a.SD_ITEM_VALUE= '1'
				AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

				UNION

			-- 死亡日期 减去 手术日期 小于等于30天
			SELECT DISTINCT
				a.PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT] AS a
				LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

				AND b.SD_ITEM_VALUE != ''
			WHERE
				a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

				AND a.SD_ITEM_CODE!= ''
				AND b.PATIENT_NO= a.PATIENT_NO
				AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
				AND DATEDIFF(
					mm,
					CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
					CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
  			) <= '1'

				UNION ALL

			-- 意外死亡
			SELECT
				PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP_RESULT]
			WHERE
				SD_ITEM_CODE = 'YXA_O_258'
				AND SD_ITEM_VALUE = '5'
	)
```
	b.各字段的完整率（文件）
2.杨尹默院长研究2
	a.符合以下条件的病例数量：有死亡终点（院内死亡88+随访死亡2656）+ 有TNM分期（9310）= 1996
```SQL
SELECT * FROM (
	-- 院内死亡
	SELECT DISTINCT
			a.PATIENT_NO
	FROM
			[dbo].[PAT_SD_ITEM_RESULT] AS a
	WHERE
			a.SD_ITEM_CODE = 'YXA_O_209'
			AND a.SD_ITEM_VALUE= '1'
			AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

			UNION

	-- 随访死亡
	SELECT DISTINCT
			a.PATIENT_NO
	FROM
			[dbo].[PAT_FOLLOW_UP_RESULT] a
	WHERE
			a.SD_ITEM_CODE= 'YXA_O_257' -- 随访死亡日期
			AND a.SD_ITEM_CODE!= ''
			AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
	) AS die

	WHERE die.PATIENT_NO IN (
		-- 有 TNM 分期的患者
		SELECT
				ret.PATIENT_NO
		FROM (

				SELECT
						a.PATIENT_NO,
								( SELECT SD_ITEM_VALUE FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_220' AND SD_ITEM_VALUE != '' ) AS 'T',

								(SELECT (CASE
														WHEN SD_ITEM_VALUE <= 0 THEN '0'
														WHEN SD_ITEM_VALUE <= 3 THEN '1'
														WHEN SD_ITEM_VALUE >= 4 THEN '2'
														ELSE '2'
												END)
									FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_222' AND SD_ITEM_VALUE != '') AS 'N',

								( SELECT (CASE SD_ITEM_VALUE
																WHEN '1' THEN '1'
																WHEN '2' THEN '0'
																ELSE NULL
														END)
										FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_224' AND SD_ITEM_VALUE != '' ) AS 'M'

						FROM [dbo].[PAT_VISIT] AS a
						WHERE a.SD_CODE= 'YXA_O' AND a.SD_GROUP= '1'

		) AS ret
		WHERE ret.T!='' AND ret.N!='' AND ret.M!=''
	)
```
	b.各字段的完整率（文件）
金佳斌的是那个pdf文件，杨院长的两个是word文件


杨院长的复发转移记录希望找出具体是哪个脏器，比如肝、肺，这些数据在随访“治疗前CT评价”及“治疗后CT评价”里有，但是都是文本，需要请北医团队的医生们来一个个判断。所以，我们先圈出符合条件的病例，然后交给医生人工判断。
我们先告诉北医两个样本量。这是第一个回合的沟通。第二个回合，第一个研究需要他们来人工判断转移脏器。


### 沙总让统计杨伊默的

请统计一下2016年1月1日-2019年9月30日，胰腺导管腺癌: 11643
	1、1年、2年、3年生存率？
	2、TNM分期？
	3、术前新辅助的比率及术后辅助治疗的比率？
	4、围手术期死亡率？

一年：55%，二年： 49%，三年没有
TNM分期：
	IA： 5.81%
	IB： 18.42%
	IIA： 15.92%
	IIB： 26.27%
	III： 15.73%
	IV： 17.85%

阳性淋巴结中位数： 2
淋巴结清扫总数目中位数： 10

术前新辅助的比率： 1.82%，术后辅助治疗的比率：40.51%
围手术期死亡率： 1.34%


### 2019年12月19日

血管侵犯改为脉管侵犯

cox 回归

0 否
1 是

肿瘤最大径：
0 小 0-2(包括2)
1 中 2-4（包括4）
2 大 4以上

肿瘤分化：
0 低
1 中
2 高

TNM分期：

0 I
1 II
2 III
3 IV

表格Excel查询 城市或自治区：

=IF(ISERR(FIND("省",D2)),MID(D2,FIND("自治区",D2)+3,(FIND("市",D2)-FIND("自治区",D2))),MID(D2,FIND("省",D2)+1,(FIND("市",D2)-FIND("省",D2))))

查询患者所在省市区，如果没有就返回原数据：

=LEFT(D2,MIN(FIND({"省","市","区"},D2&"省市区")))


东部地区包括北京、天津、河北、辽宁、上海、江苏、浙江、福建、山东、广东和海南等11个省（市）；

中部地区有8个省级行政区，分别是山西、吉林、黑龙江、安徽、江西、河南、湖北、湖南；

西部地区包括的省级行政区共12个，分别是四川、重庆、贵州、云南、西藏、陕西、甘肃、青海、宁夏、新疆、广西、内蒙古



 围手术期用药方案： 不管术前还是术后，使用AG的 围手术期用药就是AG。 术前和术后用药不同的，术后用药就是围手术期用药

 用药方案对应字典：
	 0 AG
	 1 G
	 2 GEMox
	 3 GS1
	 4 other

有 DFS 没有 OS ，算作未死亡 OS时间同DFS
DFS大于OS，删除DFS


### 2020年1月2日

```SQL
--- 查询引流液 大于6W的患者所在医院
	SELECT
		t.PATIENT_NO,
		t.AMY_POD7,
		h.HOSPITAL_NAME
	FROM
		[dbo].[PAT_DRAINAGE_TUBE] AS t
		LEFT JOIN [dbo].[PAT_VISIT] AS u ON t.PATIENT_NO= u.PATIENT_NO
		LEFT JOIN [dbo].[HOSPITAL_DICT] AS h ON u.HOSPITAL_ID= h.HOSPITAL_ID
	WHERE
		ISNUMERIC( t.AMY_POD7 ) = 1
		AND patindex( '%.%', t.AMY_POD7 ) < 1
		AND ( t.AMY_POD7+ 0 ) >= 60000
```

术前评估“可切除”的（9036）胰腺导管腺癌+至少一次随访（7066）-围手术期死亡（30天内死亡（88）+院内死亡(76)）(156)-其它原因死亡（出血+心脑血管疾病+意外）（7038） = 6961

```SQL
	-- 至少一次随访
	SELECT DISTINCT
		PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND PATIENT_NO IN (
		-- 可切除
		SELECT
			ids.PATIENT_NO
		FROM
			[dbo].[tmp_id] AS ids
			LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO= r.PATIENT_NO
		WHERE
			SD_ITEM_CODE = 'YXA_O_149'
			AND SD_ITEM_VALUE = '1'
		)
		AND PATIENT_NO NOT IN (
		-- 其它原因死亡（出血+心脑血管疾病+意外）
		SELECT
			r.PATIENT_NO
		FROM
			[dbo].[PAT_FOLLOW_UP_RESULT] AS r
			LEFT JOIN [dbo].[SD_ITEM_CV_DICT] AS d ON r.SD_ITEM_VALUE= d.CV_VALUE
			AND d.CV_CODE= 'SWYY'
		WHERE
			SD_ITEM_CODE = 'YXA_O_258'
			AND d.CV_VALUE_TEXT!= ''
			AND d.CV_VALUE IN ( '3', '4', '5' )
		)
		AND PATIENT_NO NOT IN (
			-- 查询围手术期(30天内)死亡的患者 将查询到的 PATIENT_NO 放在这里

		)
```

接受以下术式“胰十二指肠切除术、胰十二指肠切除术（联合门静脉壁切除、）胰十二指肠切除术（保留幽门）、胰体尾脾切除术、根治性顺行模块胰体尾脾切除术、胰体尾切除术（保脾）、全胰切除术、保留十二指肠的胰头肿物切除术、胰腺节段切除术、胰腺上缘肿物切除术”(9198)+至少一次随访(6704)-接受新辅助治疗=6617

接受以下术式“胰十二指肠切除术、胰十二指肠切除术（联合门静脉壁切除、）胰十二指肠切除术（保留幽门）、胰体尾脾切除术、根治性顺行模块胰体尾脾切除术、胰体尾切除术（保脾）、全胰切除术、保留十二指肠的胰头肿物切除术、胰腺节段切除术、胰腺上缘肿物切除术”(9198)+至少一次随访(6704)-接受新辅助治疗(6617)-围手术期死亡（术后30天内死亡+院内死亡）=6564

```SQL
	-- 术式“胰十二指肠切除术、胰十二指肠切除术（联合门静脉壁切除、）胰十二指肠切除术（保留幽门）、胰体尾脾切除术、根治性顺行模块胰体尾脾切除术、胰体尾切除术（保脾）、全胰切除术、保留十二指肠的胰头肿物切除术、胰腺节段切除术、胰腺上缘肿物切除术”
	SELECT
		DISTINCT ids.PATIENT_NO
	FROM
		[dbo].[tmp_id] AS ids
		LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
	WHERE
		r.SD_ITEM_CODE = 'YXA_O_151'
		AND r.SD_ITEM_VALUE IN ('1','2','3','4','5','6','7','8','12','15')
		AND ids.PATIENT_NO IN (
	-- 	至少一次随访
		SELECT
			DISTINCT PATIENT_NO
		FROM
			[dbo].[PAT_FOLLOW_UP]
		WHERE
			FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
			AND FOLLOW_UP_MONTHS!=''
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		)
		AND ids.PATIENT_NO NOT IN (
			-- 术前新辅助
			SELECT
				 r.PATIENT_NO
			FROM
				[dbo].[tmp_id] AS ids
				LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
			WHERE
				r.SD_ITEM_CODE = 'YXA_O_117'
				AND r.SD_ITEM_VALUE = '1'
		)
		AND ids.PATIENT_NO NOT IN (
			-- 查询围手术期(30天内)死亡的患者
			SELECT
				die.PATIENT_NO
			FROM (
				-- 院内死亡
				SELECT DISTINCT
					a.PATIENT_NO
				FROM
					[dbo].[PAT_SD_ITEM_RESULT] AS a
				WHERE
					a.SD_ITEM_CODE = 'YXA_O_209'
					AND a.SD_ITEM_VALUE= '1'
					AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

					UNION

				-- 死亡日期 减去 手术日期 小于等于30天
				SELECT DISTINCT
					a.PATIENT_NO
				FROM
					[dbo].[PAT_SD_ITEM_RESULT] AS a
					LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

					AND b.SD_ITEM_VALUE != ''
				WHERE
					a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

					AND a.SD_ITEM_CODE!= ''
					AND b.PATIENT_NO= a.PATIENT_NO
					AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
					AND DATEDIFF(
						mm,
						CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
						CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
					) <= '1'
			) AS die
		)
```

手术名称：YXA_O_151
	YXA_O	SSMC	1	胰十二指肠切除术
	YXA_O	SSMC	2	胰十二指肠切除术（联合门静脉壁切除）
	YXA_O	SSMC	3	胰十二指肠切除术（保留幽门）
	YXA_O	SSMC	4	胰体尾脾切除术
	YXA_O	SSMC	5	胰体尾切除术（保脾）
	YXA_O	SSMC	6	全胰切除术
	YXA_O	SSMC	7	保留十二指肠的胰头肿物切除术
	YXA_O	SSMC	8	胰腺节段切除术
	YXA_O	SSMC	12	根治性顺行模块胰体尾脾切除术
	YXA_O	SSMC	13	探查术
	YXA_O	SSMC	14	活检术
	YXA_O	SSMC	15	胰腺肿物剜除术


根治：胰十二指肠切除术、胰十二指肠切除术（联合门静脉壁切除）、胰体尾脾切除术、根治性顺行模块胰体尾脾切除术、全胰切除术
姑息： 除去根治都是姑息

根治：8280，姑息：1693，早期根治：6241，晚期姑息:323

### 开会（2020年1月10日）

T(最大径) <= 2 : 1036
T(最大径) >2 AND T(最大径)<=4 : 3281
T(最大径) > 4 : 1628

T4 : 469

```SQL
-- 查询肿瘤最大径有值的数据(6414)
	-- YXA_O_212
	-- YXA_O_213
	-- YXA_O_214
	SELECT
		PATIENT_NO,
		MAX ( SD_ITEM_VALUE ) AS 'tmax'
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_212', 'YXA_O_213', 'YXA_O_214' )
		AND SD_ITEM_VALUE != ''
		AND PATIENT_NO IN (
		SELECT DISTINCT
			ids.PATIENT_NO
		FROM
			[dbo].[tmp_id] AS ids
			LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO= r.PATIENT_NO
		WHERE
			r.SD_ITEM_CODE = 'YXA_O_151'
			AND r.SD_ITEM_VALUE IN ( '1', '2', '3', '4', '5', '6', '7', '8', '12', '15' )
			AND ids.PATIENT_NO IN (
			-- 	至少一次随访
			SELECT DISTINCT
				PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP]
			WHERE
				FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
				AND FOLLOW_UP_MONTHS != ''
				AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
			)
			AND ids.PATIENT_NO NOT IN (
			-- 术前新辅助
			SELECT
				r.PATIENT_NO
			FROM
				[dbo].[tmp_id] AS ids
				LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO= r.PATIENT_NO
			WHERE
				r.SD_ITEM_CODE = 'YXA_O_117'
				AND r.SD_ITEM_VALUE = '1'
			)
			AND ids.PATIENT_NO NOT IN (
			-- 查询围手术期(30天内)死亡的患者
			SELECT
				die.PATIENT_NO
			FROM(
				-- 院内死亡
				SELECT DISTINCT
					a.PATIENT_NO
				FROM
					[dbo].[PAT_SD_ITEM_RESULT] AS a
				WHERE
					a.SD_ITEM_CODE = 'YXA_O_209'
					AND a.SD_ITEM_VALUE= '1'
					AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
					UNION
					-- 死亡日期 减去 手术日期 小于等于30天
				SELECT
					DISTINCT a.PATIENT_NO
				FROM
					[dbo].[PAT_SD_ITEM_RESULT] AS a
					LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

					AND b.SD_ITEM_VALUE != ''
				WHERE
					a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

					AND a.SD_ITEM_CODE!= ''
					AND b.PATIENT_NO= a.PATIENT_NO
					AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
					AND DATEDIFF(
						mm,
						CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
						CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
					) <= '1'
				) AS die
			)
		)
	GROUP BY PATIENT_NO
```

```SQL
-- T4: 469

	SELECT
			ret.PATIENT_NO
	FROM (

		SELECT
			a.PATIENT_NO,
				( SELECT SD_ITEM_VALUE FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_220' AND SD_ITEM_VALUE != '' ) AS 'T',

				(SELECT (CASE
										WHEN SD_ITEM_VALUE <= 0 THEN '0'
										WHEN SD_ITEM_VALUE <= 3 THEN '1'
										WHEN SD_ITEM_VALUE >= 4 THEN '2'
										ELSE '2'
									END)
				 FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_222' AND SD_ITEM_VALUE != '') AS 'N',

				( SELECT (CASE SD_ITEM_VALUE
										WHEN '1' THEN '1'
										WHEN '2' THEN '0'
										ELSE NULL
									END)
					FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_224' AND SD_ITEM_VALUE != '' ) AS 'M'

			FROM [dbo].[PAT_VISIT] AS a
			WHERE a.PATIENT_NO IN (
			SELECT
		t.PATIENT_NO
	FROM
		(
		SELECT
			PATIENT_NO,
			MAX ( SD_ITEM_VALUE ) AS 'tmax'
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
		WHERE
			SD_ITEM_CODE IN ( 'YXA_O_212', 'YXA_O_213', 'YXA_O_214' )
			AND SD_ITEM_VALUE != ''
			AND PATIENT_NO IN (
			SELECT
			DISTINCT ids.PATIENT_NO
		FROM
			[dbo].[tmp_id] AS ids
			LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
		WHERE
			r.SD_ITEM_CODE = 'YXA_O_151'
			AND r.SD_ITEM_VALUE IN ('1','2','3','4','5','6','7','8','12','15')
			AND ids.PATIENT_NO IN (
		-- 	至少一次随访
			SELECT
				DISTINCT PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP]
			WHERE
				FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
				AND FOLLOW_UP_MONTHS!=''
				AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
			)
			AND ids.PATIENT_NO NOT IN (
				-- 术前新辅助
				SELECT
					 r.PATIENT_NO
				FROM
					[dbo].[tmp_id] AS ids
					LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
				WHERE
					r.SD_ITEM_CODE = 'YXA_O_117'
					AND r.SD_ITEM_VALUE = '1'
			)
			AND ids.PATIENT_NO NOT IN (
				-- 查询围手术期(30天内)死亡的患者
				SELECT
					die.PATIENT_NO
				FROM (
					-- 院内死亡
					SELECT DISTINCT
						a.PATIENT_NO
					FROM
						[dbo].[PAT_SD_ITEM_RESULT] AS a
					WHERE
						a.SD_ITEM_CODE = 'YXA_O_209'
						AND a.SD_ITEM_VALUE= '1'
						AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

						UNION

					-- 死亡日期 减去 手术日期 小于等于30天
					SELECT DISTINCT
						a.PATIENT_NO
					FROM
						[dbo].[PAT_SD_ITEM_RESULT] AS a
						LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

						AND b.SD_ITEM_VALUE != ''
					WHERE
						a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

						AND a.SD_ITEM_CODE!= ''
						AND b.PATIENT_NO= a.PATIENT_NO
						AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
						AND DATEDIFF(
							mm,
							CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
							CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
						) <= '1'
				) AS die
			)

			)
			GROUP BY PATIENT_NO
		) AS t

			)

	) AS ret
	WHERE ret.T!='' AND ret.N!='' AND ret.M!='' AND ret.T='4'
```

从 6414 里找
N 有数据的 5530
N0 2887
N1 2025
N2 517

从 5530 里找
M 有数据的 5406
M0 4341
M1 1065

5406 里死亡的有： 1591
```SQL
	SELECT DISTINCT PATIENT_NO FROM [dbo].[PAT_FOLLOW_UP_RESULT] WHERE SD_ITEM_CODE='YXA_O_257' AND SD_ITEM_VALUE!='' AND PATIENT_NO IN (

	SELECT
				ret.PATIENT_NO
		FROM (

			SELECT
				a.PATIENT_NO,
					( SELECT SD_ITEM_VALUE FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_220' AND SD_ITEM_VALUE != '' ) AS 'T',

					(SELECT (CASE
											WHEN SD_ITEM_VALUE <= 0 THEN '0'
											WHEN SD_ITEM_VALUE <= 3 THEN '1'
											WHEN SD_ITEM_VALUE >= 4 THEN '2'
											ELSE '2'
										END)
					 FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_222' AND SD_ITEM_VALUE != '') AS 'N',

					( SELECT (CASE SD_ITEM_VALUE
											WHEN '1' THEN '1'
											WHEN '2' THEN '0'
											ELSE NULL
										END)
						FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_224' AND SD_ITEM_VALUE != '' ) AS 'M'

				FROM [dbo].[PAT_VISIT] AS a
				WHERE a.PATIENT_NO IN (
				SELECT
			t.PATIENT_NO
		FROM
			(
			SELECT
				PATIENT_NO,
				MAX ( SD_ITEM_VALUE ) AS 'tmax'
			FROM
				[dbo].[PAT_SD_ITEM_RESULT]
			WHERE
				SD_ITEM_CODE IN ( 'YXA_O_212', 'YXA_O_213', 'YXA_O_214' )
				AND SD_ITEM_VALUE != ''
				AND PATIENT_NO IN (
				SELECT
				DISTINCT ids.PATIENT_NO
			FROM
				[dbo].[tmp_id] AS ids
				LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
			WHERE
				r.SD_ITEM_CODE = 'YXA_O_151'
				AND r.SD_ITEM_VALUE IN ('1','2','3','4','5','6','7','8','12','15')
				AND ids.PATIENT_NO IN (
			-- 	至少一次随访
				SELECT
					DISTINCT PATIENT_NO
				FROM
					[dbo].[PAT_FOLLOW_UP]
				WHERE
					FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
					AND FOLLOW_UP_MONTHS!=''
					AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
				)
				AND ids.PATIENT_NO NOT IN (
					-- 术前新辅助
					SELECT
						 r.PATIENT_NO
					FROM
						[dbo].[tmp_id] AS ids
						LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
					WHERE
						r.SD_ITEM_CODE = 'YXA_O_117'
						AND r.SD_ITEM_VALUE = '1'
				)
				AND ids.PATIENT_NO NOT IN (
					-- 查询围手术期(30天内)死亡的患者
					SELECT
						die.PATIENT_NO
					FROM (
						-- 院内死亡
						SELECT DISTINCT
							a.PATIENT_NO
						FROM
							[dbo].[PAT_SD_ITEM_RESULT] AS a
						WHERE
							a.SD_ITEM_CODE = 'YXA_O_209'
							AND a.SD_ITEM_VALUE= '1'
							AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

							UNION

						-- 死亡日期 减去 手术日期 小于等于30天
						SELECT DISTINCT
							a.PATIENT_NO
						FROM
							[dbo].[PAT_SD_ITEM_RESULT] AS a
							LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

							AND b.SD_ITEM_VALUE != ''
						WHERE
							a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

							AND a.SD_ITEM_CODE!= ''
							AND b.PATIENT_NO= a.PATIENT_NO
							AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
							AND DATEDIFF(
								mm,
								CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
								CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
							) <= '1'
					) AS die
				)

				)
				GROUP BY PATIENT_NO
			) AS t

			)

		) AS ret
		WHERE ret.N!='' AND ret.M!=''
	)
```


------------------------------------

<!-- 有复发转移终点（时间）的 1261
	有复发时间的： 1186
	有转移时间的： 972
	有复发转移时间里0-6个月复发转移的有： 551
	有复发转移时间里0-9个月复发转移的有： 811
	有复发转移时间里0-12个月复发转移的有： 991

	有复发转移时间里0-6个月复发日期的有： 508
	有复发转移时间里0-9个月复发日期的有： 768
	有复发转移时间里0-12个月复发日期的有： 951

	有复发转移时间里0-6个月转移日期的有： 716
	有复发转移时间里0-9个月转移日期的有： 989
	有复发转移时间里0-12个月转移日期的有： 1204 -->

6961里有复发转移时间的有： 1899
	6961里0-6个月复发转移的有： 817
	6961里0-9个月复发转移的有： 1173
	6961里0-12个月复发转移的有： 1442

6961里有复发时间的有： 1297
	6961里0-6个月复发的有： 508
	6961里0-9个月复发的有： 768
	6961里0-12个月复发的有： 951

6961里有转移时间的有： 1560
	6961里0-6个月转移的有： 716
	6961里0-9个月转移的有： 989
	6961里0-12个月转移的有： 1204


复发转移为是的有： 2177
<!-- 是否局部复发为是的有：1195 -->
是否局部复发为是的有（第二次计算）： 1541
<!-- 是否转移为是的有：977 -->
是否转移为是的有（第二次计算）： 1823

<!-- 复发转移为是的有：1506
是否局部复发为是的有：1429
是否转移为是的有：1199 -->

<!-- 6961里死亡的有：2147 -->
<!-- 有死亡时间：2098 -->
6961里有死亡时间：2106
复发转移死亡的患者 456
有死亡时间里0-6个月死亡的有： 401
有死亡时间里0-9个月死亡的有： 741
有死亡时间里0-12个月死亡的有： 1068

6961里排出探查术和活检术：6767
6961里术前放化疗为是的：77



以下也从 6564 里找

```SQL
-- 6564里找 SMA侵犯，肝转移，其他脏器转移 (411)
	SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_052', 'YXA_O_056', 'YXA_O_064' )
		AND SD_ITEM_VALUE='1'
		AND PATIENT_NO IN (

		SELECT
			DISTINCT ids.PATIENT_NO
		FROM
			[dbo].[tmp_id] AS ids
			LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
		WHERE
			r.SD_ITEM_CODE = 'YXA_O_151'
			AND r.SD_ITEM_VALUE IN ('1','2','3','4','5','6','7','8','12','15')
			AND ids.PATIENT_NO IN (
		-- 	至少一次随访
			SELECT
				DISTINCT PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP]
			WHERE
				FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
				AND FOLLOW_UP_MONTHS!=''
				AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
			)
			AND ids.PATIENT_NO NOT IN (
				-- 术前新辅助
				SELECT
					 r.PATIENT_NO
				FROM
					[dbo].[tmp_id] AS ids
					LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
				WHERE
					r.SD_ITEM_CODE = 'YXA_O_117'
					AND r.SD_ITEM_VALUE = '1'
			)
			AND ids.PATIENT_NO NOT IN (
				-- 查询围手术期(30天内)死亡的患者
				SELECT
					die.PATIENT_NO
				FROM (
					-- 院内死亡
					SELECT DISTINCT
						a.PATIENT_NO
					FROM
						[dbo].[PAT_SD_ITEM_RESULT] AS a
					WHERE
						a.SD_ITEM_CODE = 'YXA_O_209'
						AND a.SD_ITEM_VALUE= '1'
						AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

						UNION

					-- 死亡日期 减去 手术日期 小于等于30天
					SELECT DISTINCT
						a.PATIENT_NO
					FROM
						[dbo].[PAT_SD_ITEM_RESULT] AS a
						LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

						AND b.SD_ITEM_VALUE != ''
					WHERE
						a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

						AND a.SD_ITEM_CODE!= ''
						AND b.PATIENT_NO= a.PATIENT_NO
						AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
						AND DATEDIFF(
							mm,
							CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
							CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
						) <= '1'
				) AS die
			)
		)
```

从入组（6153）条件里剔除掉复发转移率低于10%的医院后有 4002 病例

死亡的患者有（总）：1492
	0-12 个月死亡的患者有： 863
	0-9 个月死亡的患者有： 585
	0-6 个月死亡的患者有： 303
复发转移的患者有（总）：1685
	0-12 个月复发转移的患者有： 1248
	0-9 个月复发转移的患者有： 991
	0-6 个月复发转移的患者有： 660


### 2020年03月11日统计

入组：
1. 胰腺导管腺癌
2. 手术名称(YXA_O_152)： 1,2,3,4,5,12,6,7,9,15
3. 至少一次随访
4. 排除围手术期死亡

### 2020年2月23

1.手术时间在2016-01-01到2017-12-31胰腺导管腺癌患者
2.有随访记录
排除：
	手术名称为NA
	病理诊断名称为NA

```SQL
-- 结果 5809
-- 查询手术日期为 16到17年的换患者id
-- 至少一次随访
SELECT
	PATIENT_NO,
	MAX ( FOLLOW_UP_DATE ) 
FROM
	[dbo].[PAT_FOLLOW_UP] 
WHERE
	FOLLOW_UP_DATE != '1900-01-01 00:00:00.000' 
	AND FOLLOW_UP_DATE != '' 
	AND PATIENT_NO IN ( 
	-- 手术日期在16到17年的
		SELECT
			PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT] 
		WHERE
			SD_ITEM_CODE = 'YXA_O_161' 
			AND SD_ITEM_VALUE >= '2016-01-01 00:00:00' 
			AND SD_ITEM_VALUE <= '2017-12-31 00:00:00' 
			AND PATIENT_NO IN ( 
			-- 查询 手术名称 病理诊断名称 不为空的患者
				SELECT 
					DISTINCT PATIENT_NO 
				FROM [dbo].[PAT_SD_ITEM_RESULT] 
				WHERE 
					SD_ITEM_CODE IN ( 'YXA_O_151', 'YXA_O_210' ) 
					AND SD_ITEM_VALUE != '' 
				)
)
GROUP BY
	PATIENT_NO
```

* 导出字段：
只需要医院ID、病人ID、随访ID、术前是否减黄、减黄前TB、减黄前DB、减黄前GGT、减黄后TB、减黄后DB、减黄后GGT、术前是否放化疗、CT或MRI肝转移、CT或核磁肿瘤部位、术前化验手术肿瘤部位、手术日期、手术名称、手术方式、血管受累、是否联合血管切除、血管名称、病理肿瘤大小-长、病理肿瘤大小-宽、病理肿瘤大小-高、包膜侵犯、脉管侵犯、围神经浸润、脂肪浸润、T 、T：肿瘤侵袭深度、N：LN阳性个数、N：LN检测总数、M：腹腔转移
肿瘤位置、腹膜后切缘、胰腺断端切缘、胆管断端切、十二指肠/胃断端切缘、SMA/SMV沟槽切缘、病理诊断结果、术后是否化疗、术后是否放疗、随访时间、随访时长、是否死亡、死亡日期、死亡原因


### 2020年3月16日（金薇薇 报价统计）

手术名称(YXA_O_151)是胰十二指肠切除术or胰十二指肠切除术（联合门静脉壁切除）or胰十二指肠切除术（保留幽门） 的；

手术方式(YXA_O_152)是完全腹腔镜or腔镜转开腹or完全开腹的；

M：腹腔转移(YXA_O_224)结果为否的；

```sql
-- 入组条件
SELECT  
	DISTINCT PATIENT_NO
	into #in_group
FROM
	[dbo].[PAT_SD_ITEM_RESULT] 
WHERE
	SD_ITEM_CODE = 'YXA_O_152'
	AND SD_ITEM_VALUE IN ( '1', '2', '3' ) 
	AND PATIENT_NO IN (
	SELECT DISTINCT
		PATIENT_NO 
	FROM
		[dbo].[PAT_SD_ITEM_RESULT] 
	WHERE
		SD_ITEM_CODE = 'YXA_O_151' 
		AND SD_ITEM_VALUE IN ( '1', '2', '3' ) 
		AND PATIENT_NO IN ( SELECT DISTINCT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_224' AND SD_ITEM_VALUE = '2' ) 
	)

-- 查询入组条件里各医院上报的数量
SELECT 
	h.HOSPITAL_NAME,
	COUNT( h.HOSPITAL_NAME ) AS num
FROM #in_group AS g
LEFT JOIN PAT_VISIT AS pat ON g.PATIENT_NO=pat.PATIENT_NO
LEFT JOIN HOSPITAL_DICT AS h ON pat.HOSPITAL_ID= h.HOSPITAL_ID
GROUP BY h.HOSPITAL_NAME
ORDER BY num


-- 查询入组条件里各手术方式的数量
-- 完全腹腔镜	553
-- 腔镜转开腹	194
-- 完全开腹		5400
SELECT 
	SD_ITEM_VALUE,
	COUNT( SD_ITEM_VALUE ) AS num
FROM
	[dbo].[PAT_SD_ITEM_RESULT] 
WHERE
	SD_ITEM_CODE = 'YXA_O_152'
	AND SD_ITEM_VALUE IN ( '1', '2', '3' ) 
	AND PATIENT_NO IN (
		SELECT PATIENT_NO FROM #in_group
	)
GROUP BY SD_ITEM_VALUE
ORDER BY SD_ITEM_VALUE
```

* 计算金薇薇术后化疗字段完整率

```SQL
-- 4314（术后化疗患者，包括后续计划化疗 和 随访化疗）/ 6147（金薇薇入组患者）= 70%
SELECT DISTINCT hualiao.PATIENT_NO FROM (
	SELECT
		PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT] 
	WHERE
		SD_ITEM_CODE = 'YXA_O_300' 
		AND SD_ITEM_VALUE != ''
		
		UNION
		
	SELECT
		PATIENT_NO 
	FROM
		[dbo].[PAT_FOLLOW_UP_TREAT] 
	WHERE
		TREAT_NAME IS NOT NULL
) AS hualiao

WHERE hualiao.PATIENT_NO IN (SELECT 
    DISTINCT PATIENT_NO 
    FROM
    [dbo].[PAT_SD_ITEM_RESULT] 
    WHERE
    SD_ITEM_CODE = 'YXA_O_152'
    AND SD_ITEM_VALUE IN ( '1', '2', '3' ) 
    AND PATIENT_NO IN (
    SELECT DISTINCT
        PATIENT_NO 
    FROM
        [dbo].[PAT_SD_ITEM_RESULT] 
    WHERE
        SD_ITEM_CODE = 'YXA_O_151' 
        AND SD_ITEM_VALUE IN ( '1', '2', '3' ) 
        AND PATIENT_NO IN ( SELECT DISTINCT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_224' AND SD_ITEM_VALUE = '2' ) 
    ))
	
```

### 2020年3月30日（南开）

1）现在共纳入多少患者的数据； 
	共纳入 12787
	更新 共纳入 12917
```SQL
--计算16年前
SELECT
	pat.PATIENT_NO,
	pat.NAME,
	pat.DISCHARGE_DATE,
	h.HOSPITAL_NAME
FROM
	[dbo].[PAT_VISIT] AS pat
	LEFT JOIN [dbo].[HOSPITAL_DICT] AS h ON pat.HOSPITAL_ID=h.HOSPITAL_ID
WHERE
	pat.DISCHARGE_DATE < '2016-01-01 00:00:00.000'
```

2）每位患者平均可拿到多少次住院记录；
	二次手术的患者有 304 个
	更新 二次手术的患者共 308 个
	平均可以拿到 1.024次住院记录
```SQL
-- 二次手术
SELECT
	* 
FROM
	PAT_SD_ITEM_RESULT 
WHERE
	SD_ITEM_CODE = 'YXA_O_197' 
	AND SD_ITEM_VALUE = '1' 
	AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' )
```
3）有多少患者可以同时拿到门诊和住院的数据；
	随访字段共有 44 个
4）现有的点位中从病历中可以拿到多少个？

胰腺癌平均化疗周期2.87

16年以前的的患者有 137 个
16年到19年患者有 12703 个
20年后的患者有 77 个

* 有随访的患者有多少

```SQL
-- 有随访的患者有多少(10348)
SELECT
	DISTINCT PATIENT_NO
FROM
	[dbo].[PAT_FOLLOW_UP]
```


### 化疗方案疗效统计（梁宵）

入组条件：（都满足）
	1.术后病理-诊断名称包含腺癌
	2.后续计划治疗方案-化疗药物包含：S-1、吉西他滨、白蛋白紫杉醇
	or 随访-化疗药物包含：S-1、吉西他滨、白蛋白紫杉醇
	3.至少有1次随访
排除条件：（任意满足）
	1.术后病理-诊断名称包含鳞
	2.后续计划治疗方案-化疗药物包含：卡培他滨

YXA_O_210 	诊断名称

YXA_O_301	后续计划治疗方案-药物名称（通用名）
YXA_O_302	后续计划治疗方案-药物名称（商品名）

```SQL

-- 查询至少一次随访
	SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP] 
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000' 
		AND FOLLOW_UP_MONTHS!=''
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		AND PATIENT_NO IN ( 			
		-- 查询 术后病理-诊断名称 包含 腺癌 不包含 鳞
			SELECT
			 PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT] 
			WHERE
				SD_ITEM_CODE = 'YXA_O_210' 
				AND SD_ITEM_VALUE LIKE '%腺癌%'
				AND SD_ITEM_VALUE NOT LIKE '%鳞%'
				AND PATIENT_NO IN (
		
			-- 后续计划治疗方案-化疗药物包含：S-1、吉西他滨、白蛋白紫杉醇
			SELECT
			 PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT] 
			WHERE
				 SD_ITEM_VALUE !='8'
				AND SD_ITEM_CODE='YXA_O_301'
				AND SD_ITEM_VALUE IN ('5','6','10')
				OR SD_ITEM_CODE='YXA_O_302'
				AND SD_ITEM_VALUE IN ('7','8','9','10','11','12','13','14','21','22','23')

			UNION

			-- 随访-化疗药物包含：S-1、吉西他滨、白蛋白紫杉醇
			SELECT
			 PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP_TREAT] 
			WHERE
				TREAT_NAME = '化疗'
				AND (DRUG_NAME LIKE '%S1%' 
					OR DRUG_NAME LIKE '%S-1%' 
					OR DRUG_NAME LIKE '%吉西他滨%' 
					OR DRUG_NAME LIKE '%白蛋白%' 
					OR DRUG_NAME LIKE '%白紫%')
				AND (DRUG_NAME_TRADE LIKE '%ABX%'
					OR DRUG_NAME_TRADE LIKE '%艾越%'
					OR DRUG_NAME_TRADE LIKE '%克艾力%'
					OR DRUG_NAME_TRADE LIKE '%凯素%'
					OR DRUG_NAME_TRADE LIKE '%爱斯万%'
					OR DRUG_NAME_TRADE LIKE '%维康达%'
					OR DRUG_NAME_TRADE LIKE '%艾奕%'
					OR DRUG_NAME_TRADE LIKE '%苏立%'
					OR DRUG_NAME_TRADE LIKE '%择菲%'
					OR DRUG_NAME_TRADE LIKE '%健择%'
					OR DRUG_NAME_TRADE LIKE '%辰涛%')
		)
	)
```

### 广东省人民数据申请(陈汝福)

总上报病历数： 219
完整率：80.64%
上报次数：37

入组条件“病史-糖尿病史”=有、“术后病理-诊断”包含癌的患者(2526)
更新：
入组条件“病史-糖尿病史”不为空、“术后病理-诊断”包含癌的患者(2526)

```sql
SELECT 
	DISTINCT
	ROW_NUMBER ( ) OVER ( ORDER BY PATIENT_NO ) AS id,
	PATIENT_NO 
	-- INTO calc_chen
FROM
	[dbo].[PAT_SD_ITEM_RESULT] 
WHERE
	SD_ITEM_CODE = 'YXA_O_210' 
	AND SD_ITEM_VALUE LIKE '%癌%' 
	AND SD_CODE='YXA_O'
	AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_020' AND SD_ITEM_VALUE = '1' )
```

```sql
SELECT
	* 
FROM
	[dbo].[PAT_VISIT]
	WHERE 
	SD_CODE = 'YXA_O'
	AND PATIENT_NO IN (
	-- 入组条件
		SELECT 
			DISTINCT
			PATIENT_NO 
			-- INTO calc_chen
		FROM
			[dbo].[PAT_SD_ITEM_RESULT] 
		WHERE
			SD_ITEM_CODE = 'YXA_O_210' 
			AND SD_ITEM_VALUE LIKE '%癌%' 
			AND SD_CODE='YXA_O'
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_020' AND SD_ITEM_VALUE = '1' )
	
	)
	
	AND HOSPITAL_ID='82825591ac959a8d' -- 中山孙逸仙 54 例
	-- AND HOSPITAL_ID='54bc034b46af0a8d' -- 广东省人民 39 例
	-- 广东省人民19年至今 3 例
	-- AND HOSPITAL_ID='54bc034b46af0a8d' 
	-- AND DISCHARGE_DATE >='2019-01-01 00:00:00.000'
	-- AND DISCHARGE_DATE <='2020-01-01 00:00:00.000'
```

更新（糖尿病不为空）
陈汝福 入组 13389

```sql
	-- 入组条件
	SELECT DISTINCT
		PATIENT_NO 
	FROM
		[dbo].[PAT_VISIT] 
	WHERE
		PATIENT_NO IN (
		SELECT DISTINCT
			PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT] 
		WHERE
			SD_ITEM_CODE = 'YXA_O_210' 
			AND SD_ITEM_VALUE LIKE '%癌%' 
			AND SD_CODE = 'YXA_O' 
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_CODE = 'YXA_O' AND SD_ITEM_CODE = 'YXA_O_020' AND SD_ITEM_VALUE != '' ) 
		) 
	-- AND HOSPITAL_ID = '82825591ac959a8d' -- 中山孙逸仙 315 例
	-- AND HOSPITAL_ID='54bc034b46af0a8d' -- 广东省人民 203 例
	-- 广东省人民19年至今 30 例
	-- AND HOSPITAL_ID='54bc034b46af0a8d'
	-- AND DISCHARGE_DATE >='2019-01-01 00:00:00.000'
	-- AND DISCHARGE_DATE <='2020-01-01 00:00:00.000'
```

```sql
-- 13225 -> 12670 -> 8141
-- 病理-诊断名称 入组-new
SELECT
	ROW_NUMBER ( ) OVER ( ORDER BY PATIENT_NO ) AS RowNum,
	PATIENT_NO,
	SD_ITEM_VALUE -- INTO #calc_chen
	
FROM
	[dbo].[PAT_SD_ITEM_RESULT] 
WHERE
	SD_ITEM_CODE = 'YXA_O_210' 
	AND ( SD_ITEM_VALUE LIKE '%导管腺癌%' OR SD_ITEM_VALUE LIKE '%PDAC%' OR SD_ITEM_VALUE LIKE '%daoguanxianai%' ) 
	AND PATIENT_NO IN (
	SELECT DISTINCT
		PATIENT_NO 
	FROM
		[dbo].[PAT_VISIT] 
	WHERE
		SD_CODE = 'YXA_O' 
		AND PATIENT_NO IN (
	-- 糖尿病为否(12618)+糖尿病为是的同时有糖尿病时长(2717)=15007
		SELECT
			PATIENT_NO 
		FROM
			[dbo].[PAT_SD_ITEM_RESULT] 
		WHERE
			SD_ITEM_CODE = 'YXA_O_021' 
			AND SD_ITEM_VALUE != '' 
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_020' AND SD_ITEM_VALUE = '1' ) UNION
		SELECT
			PATIENT_NO 
		FROM
			[dbo].[PAT_SD_ITEM_RESULT] 
		WHERE
			SD_ITEM_CODE = 'YXA_O_020' 
			AND SD_ITEM_VALUE = '2' 
		) 
	)
```

### 瑞金-王伟的纳排条件

纳入条件：
	1.手术名称=胰十二指肠切除术or胰十二指肠切除术（联合门静脉壁切除）or胰十二指肠切除术（保留幽门）or胰体尾脾切除术or根治性顺行模块胰体尾脾切除术or胰体尾切除术（保脾）or全胰切除术or保留十二指肠的胰头肿物切除术 YXA_O_151 in ('1','2','3','4','12','5','6','7')
	and 2.诊断名称包含“癌”
	and 3.死亡日期有值
排除条件：
	1.其他既往史 不包含“癌”or“瘤”

```SQL
-- 手术名称=胰十二指肠切除术or胰十二指肠切除术（联合门静脉壁切除）or胰十二指肠切除术（保留幽门）or胰体尾脾切除术or根治性顺行模块胰体尾脾切除术or胰体尾切除术（保脾）or全胰切除术or保留十二指肠的胰头肿物切除术
SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_151' AND SD_ITEM_VALUE IN  ('1','2','3','4','12','5','6','7')
-- 诊断名称包含“癌”
SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_210' AND SD_ITEM_VALUE LIKE '%癌%'
-- 死亡日期有值
SELECT * FROM [dbo].[PAT_FOLLOW_UP_RESULT] WHERE SD_ITEM_CODE='YXA_O_257' AND SD_ITEM_VALUE!=''
-- 其他既往史 不包含“癌”or“瘤”
SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_024' AND (SD_ITEM_VALUE NOT LIKE '%癌%' OR SD_ITEM_VALUE NOT LIKE '%瘤%')


-- 入组条件如下(2128)：
SELECT
	DISTINCT
	ROW_NUMBER ( ) OVER ( ORDER BY r1.PATIENT_NO ) AS id,
	r1.PATIENT_NO 
	INTO clac_wangwei
FROM
	[dbo].[PAT_SD_ITEM_RESULT] AS r1
	LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r2 ON r1.PATIENT_NO= r2.PATIENT_NO 
	AND r2.SD_ITEM_CODE= 'YXA_O_024' 
WHERE
	r1.SD_ITEM_CODE = 'YXA_O_151' 
	-- 手术名称=胰十二指肠切除术or胰十二指肠切除术（联合门静脉壁切除）or胰十二指肠切除术（保留幽门）or胰体尾脾切除术or根治性顺行模块胰体尾脾切除术or胰体尾切除术（保脾）or全胰切除术or保留十二指肠的胰头肿物切除术
	AND r1.SD_ITEM_VALUE IN ( '1', '2', '3', '4', '12', '5', '6', '7' ) 
	AND ( r2.SD_ITEM_VALUE NOT LIKE '%癌%' OR r2.SD_ITEM_VALUE NOT LIKE '%瘤%' OR r2.SD_ITEM_VALUE IS NULL ) -- 其他既往史 排出 癌OR瘤，包含空
	
	AND r1.PATIENT_NO IN (-- 诊断名称包含“癌”
	SELECT DISTINCT
		PATIENT_NO 
	FROM
		[dbo].[PAT_SD_ITEM_RESULT] 
	WHERE
		SD_ITEM_CODE = 'YXA_O_210' 
		AND SD_ITEM_VALUE LIKE '%癌%' 
		AND PATIENT_NO IN ( -- 死亡日期有值
		SELECT PATIENT_NO FROM [dbo].[PAT_FOLLOW_UP_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_257' AND SD_ITEM_VALUE != '' AND SD_CODE = 'YXA_O' ) 
	)
```

### 瑞金-金佳斌


```sql
-- 查询16年做过胰头手术的患者(3110)
SELECT
    PATIENT_NO
    FROM
    [dbo].[PAT_SD_ITEM_RESULT] 
    WHERE
    SD_ITEM_CODE = 'YXA_O_152' 
    AND SD_ITEM_VALUE IN ( '1', '2', '3' ) 
    AND PATIENT_NO IN ( 
    SELECT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] 
    WHERE SD_ITEM_CODE = 'YXA_O_161' AND SD_ITEM_VALUE >= '2016-01-01 00:00:00' AND SD_ITEM_VALUE <= '2016-12-31 00:00:00' )
```

纳入条件(7687)，其中瑞金的有628
1.手术名称是“胰十二指肠切除术”or“胰十二指肠切除术（联合门静脉壁切除）”or“胰十二指肠切除术（保留幽门）”
2.入院时间在“2016-01-01”到“2019-12-31”

排除条件
1.术后病理-肿瘤位置包含“体”or“尾”

```sql
SELECT
	PATIENT_NO 
FROM
	[dbo].[PAT_SD_ITEM_RESULT] 
WHERE
	SD_ITEM_CODE = 'YXA_O_151' 
	AND SD_ITEM_VALUE IN ( '1', '2', '3' ) 
	AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE ADMISSION_DATE >= '2016-01-01 00:00:00' AND ADMISSION_DATE <= '2019-12-31 00:00:00' AND SD_CODE = 'YXA_O' ) 
	AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_215' AND SD_ITEM_VALUE IN ( '1', '5' ) )
```

```sql
-- 入组条件中瑞金的有 628 例
SELECT
	* 
FROM
	[dbo].[PAT_VISIT]
	WHERE 
	SD_CODE = 'YXA_O'
	AND PATIENT_NO IN (
	-- 入组条件
		SELECT
			PATIENT_NO 
		FROM
			[dbo].[PAT_SD_ITEM_RESULT] 
		WHERE
			SD_ITEM_CODE = 'YXA_O_151' 
			AND SD_ITEM_VALUE IN ( '1', '2', '3' ) 
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE ADMISSION_DATE >= '2016-01-01 00:00:00' AND ADMISSION_DATE <= '2019-12-31 00:00:00' AND SD_CODE = 'YXA_O' ) 
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_215' AND SD_ITEM_VALUE IN ( '1', '5' ) )
	
	)
	
	AND HOSPITAL_ID='bdf2906bc6d18a8d' -- 瑞金
```

### AZ(药厂)

 OS：生存，死亡，复发/转移，其他（失访）

 parp 抑制剂

 江苏省人民，复旦肿瘤 找有没有 az的用药（parp 抑制剂）

1. 使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者人数及占所有术后辅助治疗患者的比例（a）：
	其中术前没有用过新辅助疗法的人数（b）。
	其中做过基因检测人数（c），HRR阳性或者BRCA+PALB2阳性患者人数（d，e）。
	以上各组病人中拿到OS的病人占比。

统计：
	所有术后辅助治疗的人数： 5178

	使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者人数：41, 及占所有术后辅助治疗患者的比例 0.7%
	其中术前没有用过新辅助疗法的人数：34
	其中做过基因检测人数: 0 ，HRR阳性或者BRCA+PALB2阳性患者人数: 0

	使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者人数及占所有术后辅助治疗患者中拿到OS占比：4.8%
	其中术前没有用过新辅助疗法的人数中拿到OS占比：2.9%
	其中做过基因检测人数中拿到OS占比：0%,HRR阳性或者BRCA+PALB2阳性患者中拿到OS占比：0%

	2016-2018
		所有术后辅助治疗的人数： 4170

		使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者人数：38, 及占所有术后辅助治疗患者的比例 0.91%
		其中术前没有用过新辅助疗法的人数：32
		其中做过基因检测人数: 0 ，HRR阳性或者BRCA+PALB2阳性患者人数: 0
		其中做过基因检测人数中拿到OS占比：0%,HRR阳性或者BRCA+PALB2阳性患者中拿到OS占比：0%

		使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者中
			OS完整率（随访次数正确）：23个 比例：60.53%
			存活（随访次数正确，没死亡）：21
			死亡：2
			复发/转移：16
			其他（随访日期不正确/不完整，没复发转移，没死亡）：7
		其中术前没有用过新辅助疗法的人数中
			OS完整率：19个 比例：59.37%
			存活（随访次数正确，没死亡）：18
			死亡：1
			复发/转移：14
			其他（随访日期不正确/不完整，没复发转移，没死亡）：5


	2016
		所有术后辅助治疗的人数： 1041

		使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者人数：7, 及占所有术后辅助治疗患者的比例 0.67%
		其中术前没有用过新辅助疗法的人数：7

		使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者中
			OS完整率：2个 比例：28.57%
			存活（随访次数正确，没死亡）：2
			死亡：0
			复发/转移：5
			其他（随访日期不正确/不完整，没复发转移，没死亡）：0
		其中术前没有用过新辅助疗法的人数中
			OS完整率：2个 比例：28.57%
			存活（随访次数正确，没死亡）：2
			死亡：0
			复发/转移：5
			其他（随访日期不正确/不完整，没复发转移，没死亡）：0

	2017
		所有术后辅助治疗的人数： 1658

		使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者人数：18, 及占所有术后辅助治疗患者的比例 1.1%
		其中术前没有用过新辅助疗法的人数：14

		使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者中
			OS完整率(随访次数正确)：11个 比例：61.11%
			存活（随访次数正确，没死亡）：10
			死亡：2
			复发/转移：10
			其他（随访日期不正确/不完整，没复发转移，没死亡）：4
		其中术前没有用过新辅助疗法的人数中
			OS完整率：8个 比例：57.14%
			存活（随访次数正确，没死亡）：8
			死亡：1
			复发/转移：8
			其他（随访日期不正确/不完整，没复发转移，没死亡）：3

	2018
		所有术后辅助治疗的人数： 1471

		使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者人数：13, 及占所有术后辅助治疗患者的比例 0.88%
		其中术前没有用过新辅助疗法的人数：11

		使用含铂方案（FOLFIRINOX）进行术后辅助治疗的胰腺癌患者中
			OS完整率：10个 比例：76.92%
			存活（随访次数正确，没死亡）：9
			死亡：0
			复发/转移：1
			其他（随访日期不正确/不完整，没复发转移，没死亡）：3
		其中术前没有用过新辅助疗法的人数中
			OS完整率：9个 比例：81.82%
			存活（随访次数正确，没死亡）：8
			死亡：0
			复发/转移：1
			其他（随访日期不正确/不完整，没复发转移，没死亡）：3

2. 使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者人数及占所有术后辅助化疗患者的比例（a）:
	其中一线使用含铂方案人数(b), 二线及以后使用含铂方案人数（c）。
	其中做过基因检测人数 (d), HRR或者BRCA阳性患者人数（e，f）。
	以上各组病人中拿到OS的病人占比。

统计：
	使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者人数： 468，及占所有术后辅助化疗患者的比例： 9.04%
	其中一线使用含铂方案人数：328
	其中二线及以后使用含铂方案人数：135
	其中做过基因检测人数：2，HRR或者BRCA阳性患者人数：1

	使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者人数及占所有术后辅助化疗患者中拿到OS占比： 11.8%
	其中一线使用含铂方案中拿到OS占比：16.2%, 二线及以后使用含铂方案中拿到OS占比：14.1%
	其中做过基因检测中拿到OS占比：0%, HRR或者BRCA阳性患者中拿到OS占比：0%

	2016-2018
		使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者人数： 400，及占所有术后辅助化疗患者的比例： 9.59%
		其中一线使用含铂方案人数：327
		其中二线及以后使用含铂方案人数：134
		其中做过基因检测人数：1，HRR或者BRCA阳性患者人数：0

		术后辅助化疗患者使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者中
			OS完整率（随访次数正确）：200个 比例：50.00%
			存活（随访次数正确，没死亡）：197
			死亡：55
			复发/转移：194
			其他（随访次数不正确，没复发转移，没死亡）：83

		其中一线使用含铂方案中
			OS完整率：180个 比例：55.55%
			存活（随访次数正确，没死亡）：177
			死亡：53
			复发/转移：186
			其他（随访次数不正确，没复发转移，没死亡）：35

		其中二线及以后使用含铂方案中
			OS完整率：95个 比例：71%
			存活（随访次数正确，没死亡）：92
			死亡：19
			复发/转移：78
			其他（随访次数不正确，没复发转移，没死亡）：7

		其中做过基因检测中
			存活（随访次数正确，没死亡）：0
			死亡：0
			复发/转移：1
			其他（随访次数不正确，没复发转移，没死亡）：0

	2016
		使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者人数： 109，及占所有术后辅助化疗患者的比例： 10.47%
		其中一线使用含铂方案人数：89
		其中二线及以后使用含铂方案人数：47
		其中做过基因检测人数：1，HRR或者BRCA阳性患者人数：0

		术后辅助化疗患者使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者中
			OS完整率（随访次数正确）：25个 比例：22.94%
			存活（随访次数正确，没死亡）：25
			死亡：29
			复发/转移：63
			其他（随访次数不正确，没复发转移，没死亡）：24

		其中一线使用含铂方案中
			OS完整率：20个 比例：22.47%
			存活（随访次数正确，没死亡）：20
			死亡：28
			复发/转移：60
			其他（随访次数不正确，没复发转移，没死亡）：12

		其中二线及以后使用含铂方案中
			OS完整率：18个 比例：38.3%
			存活（随访次数正确，没死亡）：18
			死亡：14
			复发/转移：31
			其他（随访次数不正确，没复发转移，没死亡）：3

		其中做过基因检测中
			存活（随访次数正确，没死亡）：0
			死亡：0
			复发/转移：0
			其他（随访次数不正确，没复发转移，没死亡）：0
		
	2017
		使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者人数： 164，及占所有术后辅助化疗患者的比例： 9.89%
		其中一线使用含铂方案人数：148
		其中二线及以后使用含铂方案人数：70
		其中做过基因检测人数：1，HRR或者BRCA阳性患者人数：0

		术后辅助化疗患者使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者中
			OS完整率（随访次数正确）：74个 比例：45.12%
			存活（随访次数正确，没死亡）：71
			死亡：26
			复发/转移：86
			其他（随访次数不正确，没复发转移，没死亡）：33

		其中一线使用含铂方案中
			OS完整率：70个 比例：47.29%
			存活（随访次数正确，没死亡）：67
			死亡：25
			复发/转移：82
			其他（随访次数不正确，没复发转移，没死亡）：23

		其中二线及以后使用含铂方案中
			OS完整率：59个 比例：84.29%
			存活（随访次数正确，没死亡）：57
			死亡：5
			复发/转移：39
			其他（随访次数不正确，没复发转移，没死亡）：4

		其中做过基因检测中
			存活（随访次数正确，没死亡）：0
			死亡：0
			复发/转移：1
			其他（随访次数不正确，没复发转移，没死亡）：0
	
	2018
		使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者人数： 127，及占所有术后辅助化疗患者的比例： 8.63%
		其中一线使用含铂方案人数：90
		其中二线及以后使用含铂方案人数：17
		其中做过基因检测人数：1，HRR或者BRCA阳性患者人数：0

		术后辅助化疗患者使用含铂方案 （FOLFIRINOX，OX，顺铂，奥沙利铂等）的晚期胰腺癌患者中
			OS完整率（随访次数正确）：101个 比例：79.53%
			存活（随访次数正确，没死亡）：101
			死亡：0
			复发/转移：45
			其他（随访次数不正确，没复发转移，没死亡）：26

		其中一线使用含铂方案中
			OS完整率：90个 比例：100%
			存活（随访次数正确，没死亡）：90
			死亡：0
			复发/转移：44
			其他（随访次数不正确，没复发转移，没死亡）：0

		其中二线及以后使用含铂方案中
			OS完整率：17个 比例：100%
			存活（随访次数正确，没死亡）：17
			死亡：0
			复发/转移：8
			其他（随访次数不正确，没复发转移，没死亡）：0

		其中做过基因检测中
			存活（随访次数正确，没死亡）：0
			死亡：0
			复发/转移：0
			其他（随访次数不正确，没复发转移，没死亡）：0

3. 曾使用过奥拉帕利（Olaparib）的患者人数 （a）。 人数：0
	其中早期患者人数 （b）。
	其中晚期患者人数 （c）。

```sql
-- 随访用药
SELECT * FROM [dbo].[PAT_FOLLOW_UP_TREAT] WHERE concat(DRUG_NAME, DRUG_NAME_TRADE,DRUG_DOSE) like '%铂%' OR concat(DRUG_NAME, DRUG_NAME_TRADE,DRUG_DOSE) like '%ox%'
-- 术前、术后、计划、放疗、化疗
SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE IN ('YXA_O_118','YXA_O_135','YXA_O_119','YXA_O_123','YXA_O_905','YXA_O_906','YXA_O_136''YXA_O_301','YXA_O_302','YXA_O_303','YXA_O_309','YXA_O_310','YXA_O_311','YXA_O_315')  AND SD_ITEM_VALUE like '%铂%' OR SD_ITEM_VALUE LIKE '%ox%'
```
```sql
-- 免疫组化中的 “其他” 字段
SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_242' AND (SD_ITEM_VALUE like '%HRR%' OR SD_ITEM_VALUE like '%BRCA%' OR SD_ITEM_VALUE like '%PALB%')
-- 血浆游离DNA检测（cf DNA）
SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_086' AND (SD_ITEM_VALUE like '%HRR%' OR SD_ITEM_VALUE like '%BRCA%' OR SD_ITEM_VALUE like '%PALB%')
```

```sql
-- 合并查询随访用药
SELECT * FROM [dbo].[PAT_FOLLOW_UP_TREAT] WHERE concat(DRUG_NAME, DRUG_NAME_TRADE,DRUG_DOSE) like '%帕利%'

-- 合并，查询 术后术前 奥拉帕利 Olaparib 普卓
SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE IN ('YXA_O_118','YXA_O_135','YXA_O_119','YXA_O_123','YXA_O_905','YXA_O_906','YXA_O_136''YXA_O_301','YXA_O_302','YXA_O_303','YXA_O_309','YXA_O_310','YXA_O_311','YXA_O_315')  AND SD_ITEM_VALUE like '%帕利%' OR SD_ITEM_VALUE LIKE '%普卓%' OR SD_ITEM_VALUE LIKE '%Ola%'
```

### 2020年6月18日
```sql
-- 统计一下出院时间在2016.1.1到2018.12.31范围内，病理诊断是导管腺癌的总的患者的数量，以及2016.1.1，2017.1.1，2018.1.1，2018.12.31这些时间点的时候库里患者病理诊断是导管腺癌的患者的数量
SELECT * FROM [dbo].[PAT_VISIT] WHERE SD_CODE='YXA_O' AND DISCHARGE_DATE>='2016-01-01 00:00:00.000' AND DISCHARGE_DATE<='2018-12-31 00:00:00.000' AND SD_GROUP='1' -- 10237

SELECT * FROM [dbo].[PAT_VISIT] WHERE SD_CODE='YXA_O' AND DISCHARGE_DATE <='2016-01-01' AND SD_GROUP='1' -- 119
SELECT * FROM [dbo].[PAT_VISIT] WHERE SD_CODE='YXA_O' AND DISCHARGE_DATE <='2017-01-01' AND SD_GROUP='1' -- 2777
SELECT * FROM [dbo].[PAT_VISIT] WHERE SD_CODE='YXA_O' AND DISCHARGE_DATE <='2018-01-01' AND SD_GROUP='1' -- 6548
SELECT * FROM [dbo].[PAT_VISIT] WHERE SD_CODE='YXA_O' AND DISCHARGE_DATE <='2018-12-31' AND SD_GROUP='1' -- 10356

SELECT * FROM [dbo].[PAT_VISIT] WHERE SD_CODE='YXA_O' AND SD_GROUP IS NULL
```

殷:
后面统计：10237为基础
1.性别分布
	男：6075 女4162
2.年龄分布
	<30	41
	30-44	501
	45-59	3371
	60-74	5422
	>=75	902

3.是否吸烟
	是：2709 否：7482 空： 46
4.是否饮酒
	是：1686 否：8359 空：192
5.是否有胰腺癌家族史
	是：84 否：9994 空：159
6.是否做过术前活检
	是：337 否：6281 空：3619
7.术前淋巴结肿大（CT有无淋巴结肿大、PET淋巴结转移2个来源，有一个是是就算有，都是否才算无）
	有：2209 无：1268 空：6760
8.术前可切除性评估
	可切除：9252 不可切除：577 空：408
9.手术名称
	保留十二指肠的胰头肿物切除术：10
	根治性顺行模块胰体尾脾切除术：117
	活检术：247
	全胰切除术：269
	探查术：530
	胰十二指肠切除术：5369
	胰十二指肠切除术（保留幽门）：305
	胰十二指肠切除术（联合门静脉壁切除）：291
	胰体尾脾切除术：2491
	胰体尾脾肿物切除术（腹腔镜）：1
	胰体尾切除术（保脾）：533
	胰腺节段切除术：51
	胰腺肿物剜除术：11
	空 12
10.手术方式
	机器人辅助	317
	纳米刀辅助	52
	腔镜转开腹	353
	完全腹腔镜	1214
	完全开腹	8127
	空	174

11.肿瘤部位（手术和病理的导出来给我，我整合一下）
	手术_肿瘤部位
		胰颈	354
		胰颈体	170
		胰体	598
		胰体尾	1704
		胰头	5739
		胰头颈	188
		胰头体	35
		胰尾	913
		空 		536
	术后病理_肿瘤部位
		胰颈	234
		胰颈体	90
		胰体	461
		胰体尾	2014
		胰头	5848
		胰头颈	110
		胰头体	30
		胰尾	910
		空		540

12.并发症CD评分
	/	146
	Ⅰ级	3928
	Ⅱ级	2001
	Ⅲa级	435
	Ⅲb级	109
	Ⅳa级	45
	Ⅳb级	18
	Ⅴ级		48
	空 		3507

13.胰漏分级
	0	275
	B级胰漏	519
	C级胰漏	56
	生化漏	1265
	空 8122

14.病理诊断结果
	R0	7058
	R1	507
	R2	198
	空 2473

15.术后住院天数
	<=10	2567
	>30		1100
	10—20	4685
	20-30	1724
	空 		161	



#### Excel 一对多对比

=IF(COUNTIF(H:H,A616)>0,1,2)