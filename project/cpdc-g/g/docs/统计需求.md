
### CPDC 待更新数据

```SQL
-- 删除胰漏分级为空和0的数据
DELETE [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_181' AND SD_ITEM_VALUE='0'
DELETE [dbo].[PAT_SD_ITEM_RESULT] WHERE SD_ITEM_CODE='YXA_O_181' AND SD_ITEM_VALUE=''
```


### 2019年11月11统计

瑞金： 'bdf2906bc6d18a8d'

三年上报总病例数： 11198
瑞金三年上报总病例数： 1074

38家三年机器人： 339
瑞金三年机器人： 237

手术日期： YXA_O_161

一年死亡的: 1986
一年死亡的: 1384
一年内没死亡： 6463
所有有随访的患者： 7847

<!-- 按年 ( DATEDIFF 按年不准确 ) -->
所有有死亡日期的患者数为： 2763
一年内死亡的： 658 + 院内死亡 91
两年内死亡的： 1479
三年内死亡的： 562
四年内死亡的： 61

<!-- 按月 -->
所有有死亡日期的患者数为： 2563 新：2656
一年内死亡的： 1342 + 院内死亡 91 = 1433
两年内死亡的： 914
三年内死亡的： 176
四年内死亡的： 8
一年内未死亡的： 4087

死亡日期不为空的患者数： 2656
```sql
-- 一年内死亡的患者
	SELECT-- *
	a.PATIENT_NO,
	a.SD_ITEM_CODE,
	CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ) AS '手术日期',
	b.SD_ITEM_CODE,
	CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 ) AS '随访死亡日期',
		DATEDIFF(
			mm,
			CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
			CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
		)
	FROM
		[dbo].[PAT_SD_ITEM_RESULT] AS a
		LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期
		AND b.SD_ITEM_VALUE != ''
	WHERE
		a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期
		AND a.SD_ITEM_CODE!= ''
		AND b.PATIENT_NO= a.PATIENT_NO
		AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		AND DATEDIFF(
			mm,
			CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
			CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
		) <= '12'
		AND DATEDIFF(
				mm,
				CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
				CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
			) > '0'
	ORDER BY
		a.PATIENT_NO
```

```sql
-- 下面是手术日期错误的数据更新
	SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO='9ee6d5baec6ad451' AND SD_ITEM_CODE='YXA_O_161'

	UPDATE [dbo].[PAT_SD_ITEM_RESULT] SET SD_ITEM_VALUE='2017-06-21' WHERE PATIENT_NO='9ee6d5baec6ad451' AND SD_ITEM_CODE='YXA_O_161'

	-- 手术日期
	SELECT * FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO='d63099debd1ecaf7' AND SD_ITEM_CODE='YXA_O_161'
	-- 更新手术日期
	UPDATE [dbo].[PAT_SD_ITEM_RESULT] SET SD_ITEM_VALUE='2017-05-09' WHERE PATIENT_NO='d63099debd1ecaf7' AND SD_ITEM_CODE='YXA_O_161'
	-- 随访死亡日期
	SELECT * FROM [dbo].[PAT_FOLLOW_UP_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_257' AND PATIENT_NO='ef4d8f9f4e07cd3d'
	-- 更新随访死亡日期
	UPDATE [dbo].[PAT_FOLLOW_UP_RESULT] SET SD_ITEM_VALUE='2018/03/12' WHERE SD_ITEM_CODE = 'YXA_O_257' AND PATIENT_NO='ef4d8f9f4e07cd3d'
	SELECT * FROM [dbo].[PAT_FOLLOW_UP_RESULT] WHERE SD_ITEM_CODE = 'YXA_O_257' AND PATIENT_NO='f33acfe826ab55a8'

	UPDATE [dbo].[PAT_FOLLOW_UP_RESULT] SET SD_ITEM_VALUE='2019/3/1' WHERE SD_ITEM_CODE = 'YXA_O_257' AND PATIENT_NO='f33acfe826ab55a8'
```
1. 随访一年以上的患者 2930
```sql
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		AND FOLLOW_UP_MONTHS >= 12 -- 大于等于12个月
	GROUP BY
		PATIENT_NO
```

2. 收集胰腺癌根治术后12个月内死亡患者
	胰腺癌根治术 =
	1 胰十二指肠切除术 +
	2 胰十二指肠切除术（联合门静脉壁切除）+
	3 胰十二指肠切除术（保留幽门）+
	12 根治性顺行模块胰体尾脾切除术
	= 704

```sql
	SELECT
	DISTINCT a.PATIENT_NO
	-- a.PATIENT_NO,
	-- a.SD_ITEM_CODE,
	-- CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ) AS '手术日期',
	-- b.SD_ITEM_CODE,
	-- CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 ) AS '随访死亡日期',
	-- DATEDIFF(
	-- 	mm,
	-- 	CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
	-- 	CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
	-- )
	FROM
		[dbo].[PAT_SD_ITEM_RESULT] AS a
		LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

		AND b.SD_ITEM_VALUE != ''
	WHERE
		a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

		AND a.SD_ITEM_CODE!= ''
		AND b.PATIENT_NO= a.PATIENT_NO
		AND a.PATIENT_NO IN (
		SELECT
			PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
		WHERE
			SD_ITEM_CODE = 'YXA_O_151'
			AND ( SD_ITEM_VALUE = '1' OR SD_ITEM_VALUE = '2' OR SD_ITEM_VALUE = '3' OR SD_ITEM_VALUE = '12' )
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		)
		AND DATEDIFF(
			mm,
			CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
			CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
		) <= '12'
		AND DATEDIFF(
			mm,
			CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
		CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
		) >= '0'
		ORDER BY a.PATIENT_NO
```
```sql
--- 胰腺癌根治术存活超过一年的(2237)
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
		AND FOLLOW_UP_MONTHS > 12 -- 超过12个月
		AND PATIENT_NO IN (
		-- 根治术
			SELECT
				PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT]
			WHERE
				SD_ITEM_CODE = 'YXA_O_151'
				AND ( SD_ITEM_VALUE = '1' OR SD_ITEM_VALUE = '2' OR SD_ITEM_VALUE = '3' OR SD_ITEM_VALUE = '12' )
				AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
			)
		AND PATIENT_NO NOT IN (
		-- 排除一年内死亡的患者
			SELECT
				DISTINCT a.PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT] AS a
				LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期
				AND b.SD_ITEM_VALUE != ''
			WHERE
				a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期
				AND a.SD_ITEM_CODE!= ''
				AND b.PATIENT_NO= a.PATIENT_NO
				AND DATEDIFF(
					mm,
					CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
					CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
				) <= '12'
				AND DATEDIFF(
					mm,
					CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
				CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
				) >= '0'
		)
	GROUP BY PATIENT_NO
```

3. 胰十二指肠切除术，胰十二指肠切除术（联合门静脉壁切除），胰十二指肠切除术（保留幽门）的患者,各有多少？
	 胰十二指肠切除术： 6172
	 胰十二指肠切除术（联合门静脉壁切除）： 330
	 胰十二指肠切除术（保留幽门）： 365
```sql
-- 胰十二指肠切除术： 6172
	SELECT
		*
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_CODE = 'YXA_O'
		AND SD_ITEM_CODE = 'YXA_O_151'
		AND SD_ITEM_VALUE = '1'
		AND PATIENT_NO IN (SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O')
```

手术名称：YXA_O_151
	YXA_O	SSMC	1	胰十二指肠切除术
	YXA_O	SSMC	2	胰十二指肠切除术（联合门静脉壁切除）
	YXA_O	SSMC	3	胰十二指肠切除术（保留幽门）
	YXA_O	SSMC	4	胰体尾脾切除术
	YXA_O	SSMC	5	胰体尾切除术（保脾）
	YXA_O	SSMC	6	全胰切除术
	YXA_O	SSMC	7	保留十二指肠的胰头肿物切除术
	YXA_O	SSMC	8	胰腺节段切除术
	YXA_O	SSMC	12	根治性顺行模块胰体尾脾切除术
	YXA_O	SSMC	13	探查术
	YXA_O	SSMC	14	活检术
	YXA_O	SSMC	15	胰腺肿物剜除术


4. 胰十二指肠切除术的病例，分别使用腹腔镜或开腹的，各有多少？
	胰十二指肠切除术中完全腹腔镜的有： 612
	胰十二指肠切除术中完全开腹的有： 5148
```sql
-- 胰十二指肠切除术中完全开腹的有： 5148
	SELECT
		*
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_CODE = 'YXA_O'
		AND SD_ITEM_CODE = 'YXA_O_152'
		AND SD_ITEM_VALUE = '3'
		AND PATIENT_NO IN (
		SELECT
			PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
		WHERE
			SD_CODE = 'YXA_O'
			AND SD_ITEM_CODE = 'YXA_O_151'
		AND SD_ITEM_VALUE = '1'
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' ))
```
手术方式： YXA_O_152
	YXA_O	SSFS	1	完全腹腔镜
	YXA_O	SSFS	2	腔镜转开腹
	YXA_O	SSFS	3	完全开腹
	YXA_O	SSFS	4	机器人辅助
	YXA_O	SSFS	5	纳米刀辅助


### 2019年11月12日

1. 去掉不可切除 且 去掉术前放化疗 且 去掉围手术期(30天内)死亡的 151

YXA_O	YXA_O_149	术前可切除性评估 SQKQCXPG
YXA	SQKQCXPG	1	可切除
YXA	SQKQCXPG	2	不可切除
YXA_O	YXA_O_117	是否放化疗 2


术后一年内有肿瘤复发或转移的患者有多少？ 1231
	有复发日期的总数 1852
	有转移日期的总数 2257
```sql
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
		AND FOLLOW_UP_MONTHS <= 12 -- 超过12个月
		AND PATIENT_NO IN (SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP_RESULT]
	WHERE
		SD_ITEM_VALUE != ''
		AND (
		SD_ITEM_CODE = 'YXA_O_251'
		OR SD_ITEM_CODE = 'YXA_O_254')
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' ) )
	GROUP BY
		PATIENT_NO
```
术后一年内无肿瘤复发或转移的患者有多少？ 2532
```sql
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
		AND FOLLOW_UP_MONTHS <= 12 -- 一年内
		AND PATIENT_NO IN (SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP_RESULT]
	WHERE
		SD_ITEM_VALUE = '2'
		AND (
		SD_ITEM_CODE = 'YXA_O_250'
		OR SD_ITEM_CODE = 'YXA_O_253')
		AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )  )
	GROUP BY
		PATIENT_NO
```
有至少一次随访中做了胰十二指肠切除术，胰十二指肠切除术（联合门静脉壁切除），胰十二指肠切除术（保留幽门）的患者有多少？ 4282
```sql
	SELECT
		PATIENT_NO,
		MAX ( FOLLOW_UP_MONTHS ) AS '随访月份'
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND FOLLOW_UP_MONTHS!=''
	-- 	AND FOLLOW_UP_MONTHS <= 12 -- 一年内
		AND PATIENT_NO IN ( SELECT
			DISTINCT PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
		WHERE
			SD_CODE = 'YXA_O'
			AND SD_ITEM_CODE = 'YXA_O_151'
			AND (SD_ITEM_VALUE = '1' OR SD_ITEM_VALUE = '2' OR SD_ITEM_VALUE = '3')
			AND PATIENT_NO IN (SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O') )
	GROUP BY
		PATIENT_NO
```



TODO:

1. 有至少一次随访资料（7306）人，完整度；
2. 所有死亡患者（2529）人，加上随访1年以上的（3930）人，完整度

下载全部死亡的 2529 下载三年有死亡时间的病例



### 2019年11月27统计

第一个：

```SQL
-- 分别列出 TNM 分期 的值

	-- T：取值
	-- N：N0:LN阳性个数为0； N1:LN阳性个数1-3； N2:LN阳性个数≥4
	-- M: 取值 （是对应1，否对应0）

	-- 分期规则：
	-- IA: T1/N0/M0
	-- IB: T2/N0/M0
	-- IIA: T3/N0/M0
	-- IIB: T1-T3, N1,M0
	-- III: 1.任何T、N2、M0；2.T4、任何N、M0
	-- IV: 任何T、任何N、M1

	SELECT
		ret.PATIENT_NO,
		ret.T,
		ret.N,
		ret.M,
		(CASE
			WHEN ret.T='1' AND ret.N='0' AND ret.M='0' THEN 'IA'
			WHEN ret.T='2' AND ret.N='0' AND ret.M='0' THEN 'IB'
			WHEN ret.T='3' AND ret.N='0' AND ret.M='0' THEN 'IIA'
			WHEN ret.T IN ('1','2','3') AND ret.N='1' AND ret.M='0' THEN 'IIB'
			WHEN ret.M='0' THEN 'III'
			WHEN ret.M='1' THEN 'IV'
			ELSE NULL
		END
		) AS '分期'
	FROM (

		SELECT
			a.PATIENT_NO,
				( SELECT SD_ITEM_VALUE FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_220' ) AS 'T',

				( SELECT (CASE
							WHEN SD_ITEM_VALUE <= '0' THEN '0'
							WHEN SD_ITEM_VALUE IN ('1','2','3') THEN '1'
							WHEN SD_ITEM_VALUE >= '4' THEN '2'
							ELSE NULL
						END)
					FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_222' ) AS 'N',

				( SELECT (CASE SD_ITEM_VALUE
								WHEN '1' THEN '1'
								WHEN '2' THEN '0'
								ELSE NULL
							END)
					FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_224' ) AS 'M'

			FROM [dbo].[PAT_VISIT] AS a
			WHERE a.SD_CODE= 'YXA_O' AND a.SD_GROUP= '1'

	) AS ret
	WHERE ret.T!='' AND ret.N!='' AND ret.M!=''
```


第二个重要工作。计算“有死亡终点”，“有病情进展”终点的两类患者数量，这些患者需要以下数据项有记录：

a 血管侵犯：“术后病理”章节的“脉管侵犯”字段 YXA_O_217
b 淋巴结转移：“术后病理”章节的“N:LN阳性个数” YXA_O_222
c 神经浸润：“术后病理”章节的“围神经浸润” YXA_O_218
d 肿瘤分化程度：“术后病理”章节的“分化” YXA_O_211
e TNM分期
f 新辅助治疗：“术前治疗”章节的“是否放化疗”选择“是”，且“化疗药物有名称，或者放疗剂量有数值”。 'YXA_O_118','YXA_O_119'
g 术后辅助治疗：“后续计划治疗方案”章节的“是否化疗”选择“是”，且“化疗药物有名称，或者放疗剂量有数值” 'YXA_O_301','YXA_O_303'
h  手术方式 YXA_O_152
i 肝转移：“增强CT/MRI”章节“肝转移”字段 YXA_O_056

```SQL
-- 查询有死亡终点而且有以下数据项的患者
	SELECT DISTINCT
		PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_118', 'YXA_O_119', 'YXA_O_301', 'YXA_O_303', 'YXA_O_217', 'YXA_O_222', 'YXA_O_218', 'YXA_O_211', 'YXA_O_152', 'YXA_O_056','YXA_O_220','YXA_O_222','YXA_O_224')
		AND SD_ITEM_VALUE != ''
		AND PATIENT_NO IN (SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP_RESULT]
	WHERE
		SD_ITEM_CODE = 'YXA_O_257'
		AND SD_ITEM_VALUE != ''
		AND PATIENT_NO IN (SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O'))
```
```SQL
-- 查询有病情进展而且有以下数据项的患者
	SELECT DISTINCT
		PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_118', 'YXA_O_119', 'YXA_O_301', 'YXA_O_303', 'YXA_O_217', 'YXA_O_222', 'YXA_O_218', 'YXA_O_211', 'YXA_O_152', 'YXA_O_056','YXA_O_220','YXA_O_222','YXA_O_224')
		AND SD_ITEM_VALUE != ''
		AND PATIENT_NO IN (SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE = 'YXA_O_920'
		AND SD_ITEM_VALUE ='1'
		AND PATIENT_NO IN (SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O'))
```

这两组患者是所有有至少一次随访记录的患者，包括死亡的，没死亡的
	1.胰十二指肠切除术+腹腔镜 287
	2.胰十二指肠切除术+完全开腹术 3724
	其中，“胰十二指肠切除术”包括“胰十二指肠切除术”“胰十二指肠切除术（联合门静脉壁切除）”及“胰十二指肠切除术（保留幽门）”三种术式。


=LEFT(D2,MIN(FIND({"省","市","区"},D2&"省市区")))

=IF(A1>30,"肥胖",IF(A1>25,"超重",IF(A1<25,"正常")))



### 近期的三项专家研究

请协助计算几个数据，然后提交专家：
1.金佳斌研究：请计算各字段的完整率（文件）
2.杨尹默院长研究1
	a.符合以下条件的病例数量：有随访记录（8853）+ 有复发或转移记录（1505） + 有围手术期药物治疗的（3707）- 围手术期死亡（158）-术后意外死亡（3）= 831
```SQL
	SELECT
		DISTINCT PATIENT_NO
	FROM (

		-- 有复发转移（也有随访）记录的 YXA_O_921
		SELECT DISTINCT
			PATIENT_NO
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
			WHERE
				SD_ITEM_CODE = 'YXA_O_921'
				AND SD_ITEM_VALUE = '1'
				AND PATIENT_NO IN (

				-- 有围手术期治疗（术前，术后治疗）
				SELECT
					DISTINCT PATIENT_NO
				FROM [dbo].[PAT_SD_ITEM_RESULT]
					WHERE SD_ITEM_CODE IN ( 'YXA_O_117', 'YXA_O_134', 'YXA_O_300' )
					AND SD_ITEM_VALUE = '1'
					AND PATIENT_NO IN (

							-- 有随访记录
							SELECT DISTINCT
								PATIENT_NO
							FROM
							[dbo].[PAT_FOLLOW_UP]
						)
				)

		) AS list
	WHERE
	PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O')

	AND PATIENT_NO NOT IN (

			-- 院内死亡
			SELECT DISTINCT
				a.PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT] AS a
			WHERE
				a.SD_ITEM_CODE = 'YXA_O_209'
				AND a.SD_ITEM_VALUE= '1'
				AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

				UNION

			-- 死亡日期 减去 手术日期 小于等于30天
			SELECT DISTINCT
				a.PATIENT_NO
			FROM
				[dbo].[PAT_SD_ITEM_RESULT] AS a
				LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

				AND b.SD_ITEM_VALUE != ''
			WHERE
				a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

				AND a.SD_ITEM_CODE!= ''
				AND b.PATIENT_NO= a.PATIENT_NO
				AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
				AND DATEDIFF(
					mm,
					CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
					CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
  			) <= '1'

				UNION ALL

			-- 意外死亡
			SELECT
				PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP_RESULT]
			WHERE
				SD_ITEM_CODE = 'YXA_O_258'
				AND SD_ITEM_VALUE = '5'
	)
```
	b.各字段的完整率（文件）
2.杨尹默院长研究2
	a.符合以下条件的病例数量：有死亡终点（院内死亡88+随访死亡2656）+ 有TNM分期（9310）= 1996
```SQL
SELECT * FROM (
	-- 院内死亡
	SELECT DISTINCT
			a.PATIENT_NO
	FROM
			[dbo].[PAT_SD_ITEM_RESULT] AS a
	WHERE
			a.SD_ITEM_CODE = 'YXA_O_209'
			AND a.SD_ITEM_VALUE= '1'
			AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

			UNION

	-- 随访死亡
	SELECT DISTINCT
			a.PATIENT_NO
	FROM
			[dbo].[PAT_FOLLOW_UP_RESULT] a
	WHERE
			a.SD_ITEM_CODE= 'YXA_O_257' -- 随访死亡日期
			AND a.SD_ITEM_CODE!= ''
			AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
	) AS die

	WHERE die.PATIENT_NO IN (
		-- 有 TNM 分期的患者
		SELECT
				ret.PATIENT_NO
		FROM (

				SELECT
						a.PATIENT_NO,
								( SELECT SD_ITEM_VALUE FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_220' AND SD_ITEM_VALUE != '' ) AS 'T',

								(SELECT (CASE
														WHEN SD_ITEM_VALUE <= 0 THEN '0'
														WHEN SD_ITEM_VALUE <= 3 THEN '1'
														WHEN SD_ITEM_VALUE >= 4 THEN '2'
														ELSE '2'
												END)
									FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_222' AND SD_ITEM_VALUE != '') AS 'N',

								( SELECT (CASE SD_ITEM_VALUE
																WHEN '1' THEN '1'
																WHEN '2' THEN '0'
																ELSE NULL
														END)
										FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_224' AND SD_ITEM_VALUE != '' ) AS 'M'

						FROM [dbo].[PAT_VISIT] AS a
						WHERE a.SD_CODE= 'YXA_O' AND a.SD_GROUP= '1'

		) AS ret
		WHERE ret.T!='' AND ret.N!='' AND ret.M!=''
	)
```
	b.各字段的完整率（文件）
金佳斌的是那个pdf文件，杨院长的两个是word文件


杨院长的复发转移记录希望找出具体是哪个脏器，比如肝、肺，这些数据在随访“治疗前CT评价”及“治疗后CT评价”里有，但是都是文本，需要请北医团队的医生们来一个个判断。所以，我们先圈出符合条件的病例，然后交给医生人工判断。
我们先告诉北医两个样本量。这是第一个回合的沟通。第二个回合，第一个研究需要他们来人工判断转移脏器。



### 沙总让统计杨伊默的

请统计一下2016年1月1日-2019年9月30日，胰腺导管腺癌: 11643
	1、1年、2年、3年生存率？
	2、TNM分期？
	3、术前新辅助的比率及术后辅助治疗的比率？
	4、围手术期死亡率？

一年：55%，二年： 49%，三年没有
TNM分期：
	IA： 5.81%
	IB： 18.42%
	IIA： 15.92%
	IIB： 26.27%
	III： 15.73%
	IV： 17.85%

阳性淋巴结中位数： 2
淋巴结清扫总数目中位数： 10

术前新辅助的比率： 1.82%，术后辅助治疗的比率：40.51%
围手术期死亡率： 1.34%


### 2019年12月19日

血管侵犯改为脉管侵犯


cox 回归

0 否
1 是

肿瘤最大径：
0 小 0-2(包括2)
1 中 2-4（包括4）
2 大 4以上

肿瘤分化：
0 低
1 中
2 高

TNM分期：

0 I
1 II
2 III
3 IV

表格Excel查询 城市或自治区：

=IF(ISERR(FIND("省",D2)),MID(D2,FIND("自治区",D2)+3,(FIND("市",D2)-FIND("自治区",D2))),MID(D2,FIND("省",D2)+1,(FIND("市",D2)-FIND("省",D2))))

查询患者所在省市区，如果没有就返回原数据：

=LEFT(D2,MIN(FIND({"省","市","区"},D2&"省市区")))


东部地区包括北京、天津、河北、辽宁、上海、江苏、浙江、福建、山东、广东和海南等11个省（市）；

中部地区有8个省级行政区，分别是山西、吉林、黑龙江、安徽、江西、河南、湖北、湖南；

西部地区包括的省级行政区共12个，分别是四川、重庆、贵州、云南、西藏、陕西、甘肃、青海、宁夏、新疆、广西、内蒙古



 围手术期用药方案： 不管术前还是术后，使用AG的 围手术期用药就是AG。 术前和术后用药不同的，术后用药就是围手术期用药

 用药方案对应字典：
	 0 AG
	 1 G
	 2 GEMox
	 3 GS1
	 4 other

有 DFS 没有 OS ，算作未死亡 OS时间同DFS
DFS大于OS，删除DFS


### 2020年1月2日

```SQL
--- 查询引流液 大于6W的患者所在医院
	SELECT
		t.PATIENT_NO,
		t.AMY_POD7,
		h.HOSPITAL_NAME
	FROM
		[dbo].[PAT_DRAINAGE_TUBE] AS t
		LEFT JOIN [dbo].[PAT_VISIT] AS u ON t.PATIENT_NO= u.PATIENT_NO
		LEFT JOIN [dbo].[HOSPITAL_DICT] AS h ON u.HOSPITAL_ID= h.HOSPITAL_ID
	WHERE
		ISNUMERIC( t.AMY_POD7 ) = 1
		AND patindex( '%.%', t.AMY_POD7 ) < 1
		AND ( t.AMY_POD7+ 0 ) >= 60000
```

术前评估“可切除”的（9036）胰腺导管腺癌+至少一次随访（7066）-围手术期死亡（30天内死亡（88）+院内死亡(76)）(156)-其它原因死亡（出血+心脑血管疾病+意外）（7038） = 6961

```SQL
	-- 至少一次随访
	SELECT DISTINCT
		PATIENT_NO
	FROM
		[dbo].[PAT_FOLLOW_UP]
	WHERE
		FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
		AND PATIENT_NO IN (
		-- 可切除
		SELECT
			ids.PATIENT_NO
		FROM
			[dbo].[tmp_id] AS ids
			LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO= r.PATIENT_NO
		WHERE
			SD_ITEM_CODE = 'YXA_O_149'
			AND SD_ITEM_VALUE = '1'
		)
		AND PATIENT_NO NOT IN (
		-- 其它原因死亡（出血+心脑血管疾病+意外）
		SELECT
			r.PATIENT_NO
		FROM
			[dbo].[PAT_FOLLOW_UP_RESULT] AS r
			LEFT JOIN [dbo].[SD_ITEM_CV_DICT] AS d ON r.SD_ITEM_VALUE= d.CV_VALUE
			AND d.CV_CODE= 'SWYY'
		WHERE
			SD_ITEM_CODE = 'YXA_O_258'
			AND d.CV_VALUE_TEXT!= ''
			AND d.CV_VALUE IN ( '3', '4', '5' )
		)
		AND PATIENT_NO NOT IN (
			-- 查询围手术期(30天内)死亡的患者 将查询到的 PATIENT_NO 放在这里

		)
```

接受以下术式“胰十二指肠切除术、胰十二指肠切除术（联合门静脉壁切除、）胰十二指肠切除术（保留幽门）、胰体尾脾切除术、根治性顺行模块胰体尾脾切除术、胰体尾切除术（保脾）、全胰切除术、保留十二指肠的胰头肿物切除术、胰腺节段切除术、胰腺上缘肿物切除术”(9198)+至少一次随访(6704)-接受新辅助治疗=6617

接受以下术式“胰十二指肠切除术、胰十二指肠切除术（联合门静脉壁切除、）胰十二指肠切除术（保留幽门）、胰体尾脾切除术、根治性顺行模块胰体尾脾切除术、胰体尾切除术（保脾）、全胰切除术、保留十二指肠的胰头肿物切除术、胰腺节段切除术、胰腺上缘肿物切除术”(9198)+至少一次随访(6704)-接受新辅助治疗(6617)-围手术期死亡（术后30天内死亡+院内死亡）=6564

```SQL
	-- 术式“胰十二指肠切除术、胰十二指肠切除术（联合门静脉壁切除、）胰十二指肠切除术（保留幽门）、胰体尾脾切除术、根治性顺行模块胰体尾脾切除术、胰体尾切除术（保脾）、全胰切除术、保留十二指肠的胰头肿物切除术、胰腺节段切除术、胰腺上缘肿物切除术”
	SELECT
		DISTINCT ids.PATIENT_NO
	FROM
		[dbo].[tmp_id] AS ids
		LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
	WHERE
		r.SD_ITEM_CODE = 'YXA_O_151'
		AND r.SD_ITEM_VALUE IN ('1','2','3','4','5','6','7','8','12','15')
		AND ids.PATIENT_NO IN (
	-- 	至少一次随访
		SELECT
			DISTINCT PATIENT_NO
		FROM
			[dbo].[PAT_FOLLOW_UP]
		WHERE
			FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
			AND FOLLOW_UP_MONTHS!=''
			AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
		)
		AND ids.PATIENT_NO NOT IN (
			-- 术前新辅助
			SELECT
				 r.PATIENT_NO
			FROM
				[dbo].[tmp_id] AS ids
				LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
			WHERE
				r.SD_ITEM_CODE = 'YXA_O_117'
				AND r.SD_ITEM_VALUE = '1'
		)
		AND ids.PATIENT_NO NOT IN (
			-- 查询围手术期(30天内)死亡的患者
			SELECT
				die.PATIENT_NO
			FROM (
				-- 院内死亡
				SELECT DISTINCT
					a.PATIENT_NO
				FROM
					[dbo].[PAT_SD_ITEM_RESULT] AS a
				WHERE
					a.SD_ITEM_CODE = 'YXA_O_209'
					AND a.SD_ITEM_VALUE= '1'
					AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

					UNION

				-- 死亡日期 减去 手术日期 小于等于30天
				SELECT DISTINCT
					a.PATIENT_NO
				FROM
					[dbo].[PAT_SD_ITEM_RESULT] AS a
					LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

					AND b.SD_ITEM_VALUE != ''
				WHERE
					a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

					AND a.SD_ITEM_CODE!= ''
					AND b.PATIENT_NO= a.PATIENT_NO
					AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
					AND DATEDIFF(
						mm,
						CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
						CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
					) <= '1'
			) AS die
		)
```

手术名称：YXA_O_151
	YXA_O	SSMC	1	胰十二指肠切除术
	YXA_O	SSMC	2	胰十二指肠切除术（联合门静脉壁切除）
	YXA_O	SSMC	3	胰十二指肠切除术（保留幽门）
	YXA_O	SSMC	4	胰体尾脾切除术
	YXA_O	SSMC	5	胰体尾切除术（保脾）
	YXA_O	SSMC	6	全胰切除术
	YXA_O	SSMC	7	保留十二指肠的胰头肿物切除术
	YXA_O	SSMC	8	胰腺节段切除术
	YXA_O	SSMC	12	根治性顺行模块胰体尾脾切除术
	YXA_O	SSMC	13	探查术
	YXA_O	SSMC	14	活检术
	YXA_O	SSMC	15	胰腺肿物剜除术


根治：胰十二指肠切除术、胰十二指肠切除术（联合门静脉壁切除）、胰体尾脾切除术、根治性顺行模块胰体尾脾切除术、全胰切除术
姑息： 除去根治都是姑息

根治：8280，姑息：1693，早期根治：6241，晚期姑息:323

### 开会（2020年1月10日）

T(最大径) <= 2 : 1036
T(最大径) >2 AND T(最大径)<=4 : 3281
T(最大径) > 4 : 1628

T4 : 469

```SQL
-- 查询肿瘤最大径有值的数据(6414)
	-- YXA_O_212
	-- YXA_O_213
	-- YXA_O_214
	SELECT
		PATIENT_NO,
		MAX ( SD_ITEM_VALUE ) AS 'tmax'
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_212', 'YXA_O_213', 'YXA_O_214' )
		AND SD_ITEM_VALUE != ''
		AND PATIENT_NO IN (
		SELECT DISTINCT
			ids.PATIENT_NO
		FROM
			[dbo].[tmp_id] AS ids
			LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO= r.PATIENT_NO
		WHERE
			r.SD_ITEM_CODE = 'YXA_O_151'
			AND r.SD_ITEM_VALUE IN ( '1', '2', '3', '4', '5', '6', '7', '8', '12', '15' )
			AND ids.PATIENT_NO IN (
			-- 	至少一次随访
			SELECT DISTINCT
				PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP]
			WHERE
				FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
				AND FOLLOW_UP_MONTHS != ''
				AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
			)
			AND ids.PATIENT_NO NOT IN (
			-- 术前新辅助
			SELECT
				r.PATIENT_NO
			FROM
				[dbo].[tmp_id] AS ids
				LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO= r.PATIENT_NO
			WHERE
				r.SD_ITEM_CODE = 'YXA_O_117'
				AND r.SD_ITEM_VALUE = '1'
			)
			AND ids.PATIENT_NO NOT IN (
			-- 查询围手术期(30天内)死亡的患者
			SELECT
				die.PATIENT_NO
			FROM(
				-- 院内死亡
				SELECT DISTINCT
					a.PATIENT_NO
				FROM
					[dbo].[PAT_SD_ITEM_RESULT] AS a
				WHERE
					a.SD_ITEM_CODE = 'YXA_O_209'
					AND a.SD_ITEM_VALUE= '1'
					AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
					UNION
					-- 死亡日期 减去 手术日期 小于等于30天
				SELECT
					DISTINCT a.PATIENT_NO
				FROM
					[dbo].[PAT_SD_ITEM_RESULT] AS a
					LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

					AND b.SD_ITEM_VALUE != ''
				WHERE
					a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

					AND a.SD_ITEM_CODE!= ''
					AND b.PATIENT_NO= a.PATIENT_NO
					AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
					AND DATEDIFF(
						mm,
						CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
						CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
					) <= '1'
				) AS die
			)
		)
	GROUP BY PATIENT_NO
```

```SQL
-- T4: 469

	SELECT
			ret.PATIENT_NO
	FROM (

		SELECT
			a.PATIENT_NO,
				( SELECT SD_ITEM_VALUE FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_220' AND SD_ITEM_VALUE != '' ) AS 'T',

				(SELECT (CASE
										WHEN SD_ITEM_VALUE <= 0 THEN '0'
										WHEN SD_ITEM_VALUE <= 3 THEN '1'
										WHEN SD_ITEM_VALUE >= 4 THEN '2'
										ELSE '2'
									END)
				 FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_222' AND SD_ITEM_VALUE != '') AS 'N',

				( SELECT (CASE SD_ITEM_VALUE
										WHEN '1' THEN '1'
										WHEN '2' THEN '0'
										ELSE NULL
									END)
					FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_224' AND SD_ITEM_VALUE != '' ) AS 'M'

			FROM [dbo].[PAT_VISIT] AS a
			WHERE a.PATIENT_NO IN (
			SELECT
		t.PATIENT_NO
	FROM
		(
		SELECT
			PATIENT_NO,
			MAX ( SD_ITEM_VALUE ) AS 'tmax'
		FROM
			[dbo].[PAT_SD_ITEM_RESULT]
		WHERE
			SD_ITEM_CODE IN ( 'YXA_O_212', 'YXA_O_213', 'YXA_O_214' )
			AND SD_ITEM_VALUE != ''
			AND PATIENT_NO IN (
			SELECT
			DISTINCT ids.PATIENT_NO
		FROM
			[dbo].[tmp_id] AS ids
			LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
		WHERE
			r.SD_ITEM_CODE = 'YXA_O_151'
			AND r.SD_ITEM_VALUE IN ('1','2','3','4','5','6','7','8','12','15')
			AND ids.PATIENT_NO IN (
		-- 	至少一次随访
			SELECT
				DISTINCT PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP]
			WHERE
				FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
				AND FOLLOW_UP_MONTHS!=''
				AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
			)
			AND ids.PATIENT_NO NOT IN (
				-- 术前新辅助
				SELECT
					 r.PATIENT_NO
				FROM
					[dbo].[tmp_id] AS ids
					LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
				WHERE
					r.SD_ITEM_CODE = 'YXA_O_117'
					AND r.SD_ITEM_VALUE = '1'
			)
			AND ids.PATIENT_NO NOT IN (
				-- 查询围手术期(30天内)死亡的患者
				SELECT
					die.PATIENT_NO
				FROM (
					-- 院内死亡
					SELECT DISTINCT
						a.PATIENT_NO
					FROM
						[dbo].[PAT_SD_ITEM_RESULT] AS a
					WHERE
						a.SD_ITEM_CODE = 'YXA_O_209'
						AND a.SD_ITEM_VALUE= '1'
						AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

						UNION

					-- 死亡日期 减去 手术日期 小于等于30天
					SELECT DISTINCT
						a.PATIENT_NO
					FROM
						[dbo].[PAT_SD_ITEM_RESULT] AS a
						LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

						AND b.SD_ITEM_VALUE != ''
					WHERE
						a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

						AND a.SD_ITEM_CODE!= ''
						AND b.PATIENT_NO= a.PATIENT_NO
						AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
						AND DATEDIFF(
							mm,
							CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
							CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
						) <= '1'
				) AS die
			)

			)
			GROUP BY PATIENT_NO
		) AS t

			)

	) AS ret
	WHERE ret.T!='' AND ret.N!='' AND ret.M!='' AND ret.T='4'
```

从 6414 里找
N 有数据的 5530
N0 2887
N1 2025
N2 517

从 5530 里找
M 有数据的 5406
M0 4341
M1 1065

5406 里死亡的有： 1591
```SQL
	SELECT DISTINCT PATIENT_NO FROM [dbo].[PAT_FOLLOW_UP_RESULT] WHERE SD_ITEM_CODE='YXA_O_257' AND SD_ITEM_VALUE!='' AND PATIENT_NO IN (

	SELECT
				ret.PATIENT_NO
		FROM (

			SELECT
				a.PATIENT_NO,
					( SELECT SD_ITEM_VALUE FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_220' AND SD_ITEM_VALUE != '' ) AS 'T',

					(SELECT (CASE
											WHEN SD_ITEM_VALUE <= 0 THEN '0'
											WHEN SD_ITEM_VALUE <= 3 THEN '1'
											WHEN SD_ITEM_VALUE >= 4 THEN '2'
											ELSE '2'
										END)
					 FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_222' AND SD_ITEM_VALUE != '') AS 'N',

					( SELECT (CASE SD_ITEM_VALUE
											WHEN '1' THEN '1'
											WHEN '2' THEN '0'
											ELSE NULL
										END)
						FROM [dbo].[PAT_SD_ITEM_RESULT] WHERE PATIENT_NO = a.PATIENT_NO AND SD_ITEM_CODE = 'YXA_O_224' AND SD_ITEM_VALUE != '' ) AS 'M'

				FROM [dbo].[PAT_VISIT] AS a
				WHERE a.PATIENT_NO IN (
				SELECT
			t.PATIENT_NO
		FROM
			(
			SELECT
				PATIENT_NO,
				MAX ( SD_ITEM_VALUE ) AS 'tmax'
			FROM
				[dbo].[PAT_SD_ITEM_RESULT]
			WHERE
				SD_ITEM_CODE IN ( 'YXA_O_212', 'YXA_O_213', 'YXA_O_214' )
				AND SD_ITEM_VALUE != ''
				AND PATIENT_NO IN (
				SELECT
				DISTINCT ids.PATIENT_NO
			FROM
				[dbo].[tmp_id] AS ids
				LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
			WHERE
				r.SD_ITEM_CODE = 'YXA_O_151'
				AND r.SD_ITEM_VALUE IN ('1','2','3','4','5','6','7','8','12','15')
				AND ids.PATIENT_NO IN (
			-- 	至少一次随访
				SELECT
					DISTINCT PATIENT_NO
				FROM
					[dbo].[PAT_FOLLOW_UP]
				WHERE
					FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
					AND FOLLOW_UP_MONTHS!=''
					AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
				)
				AND ids.PATIENT_NO NOT IN (
					-- 术前新辅助
					SELECT
						 r.PATIENT_NO
					FROM
						[dbo].[tmp_id] AS ids
						LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
					WHERE
						r.SD_ITEM_CODE = 'YXA_O_117'
						AND r.SD_ITEM_VALUE = '1'
				)
				AND ids.PATIENT_NO NOT IN (
					-- 查询围手术期(30天内)死亡的患者
					SELECT
						die.PATIENT_NO
					FROM (
						-- 院内死亡
						SELECT DISTINCT
							a.PATIENT_NO
						FROM
							[dbo].[PAT_SD_ITEM_RESULT] AS a
						WHERE
							a.SD_ITEM_CODE = 'YXA_O_209'
							AND a.SD_ITEM_VALUE= '1'
							AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

							UNION

						-- 死亡日期 减去 手术日期 小于等于30天
						SELECT DISTINCT
							a.PATIENT_NO
						FROM
							[dbo].[PAT_SD_ITEM_RESULT] AS a
							LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

							AND b.SD_ITEM_VALUE != ''
						WHERE
							a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

							AND a.SD_ITEM_CODE!= ''
							AND b.PATIENT_NO= a.PATIENT_NO
							AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
							AND DATEDIFF(
								mm,
								CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
								CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
							) <= '1'
					) AS die
				)

				)
				GROUP BY PATIENT_NO
			) AS t

			)

		) AS ret
		WHERE ret.N!='' AND ret.M!=''
	)
```


------------------------------------

<!-- 有复发转移终点（时间）的 1261
	有复发时间的： 1186
	有转移时间的： 972
	有复发转移时间里0-6个月复发转移的有： 551
	有复发转移时间里0-9个月复发转移的有： 811
	有复发转移时间里0-12个月复发转移的有： 991

	有复发转移时间里0-6个月复发日期的有： 508
	有复发转移时间里0-9个月复发日期的有： 768
	有复发转移时间里0-12个月复发日期的有： 951

	有复发转移时间里0-6个月转移日期的有： 716
	有复发转移时间里0-9个月转移日期的有： 989
	有复发转移时间里0-12个月转移日期的有： 1204 -->

6961里有复发转移时间的有： 1899
	6961里0-6个月复发转移的有： 817
	6961里0-9个月复发转移的有： 1173
	6961里0-12个月复发转移的有： 1442

6961里有复发时间的有： 1297
	6961里0-6个月复发的有： 508
	6961里0-9个月复发的有： 768
	6961里0-12个月复发的有： 951

6961里有转移时间的有： 1560
	6961里0-6个月转移的有： 716
	6961里0-9个月转移的有： 989
	6961里0-12个月转移的有： 1204


复发转移为是的有： 2177
<!-- 是否局部复发为是的有：1195 -->
是否局部复发为是的有（第二次计算）： 1541
<!-- 是否转移为是的有：977 -->
是否转移为是的有（第二次计算）： 1823

<!-- 复发转移为是的有：1506
是否局部复发为是的有：1429
是否转移为是的有：1199 -->

<!-- 6961里死亡的有：2147 -->
<!-- 有死亡时间：2098 -->
6961里有死亡时间：2106
复发转移死亡的患者 456
有死亡时间里0-6个月死亡的有： 401
有死亡时间里0-9个月死亡的有： 741
有死亡时间里0-12个月死亡的有： 1068

6961里排出探查术和活检术：6767
6961里术前放化疗为是的：77



以下也从 6564 里找

```SQL
-- 6564里找 SMA侵犯，肝转移，其他脏器转移 (411)
	SELECT
		DISTINCT PATIENT_NO
	FROM
		[dbo].[PAT_SD_ITEM_RESULT]
	WHERE
		SD_ITEM_CODE IN ( 'YXA_O_052', 'YXA_O_056', 'YXA_O_064' )
		AND SD_ITEM_VALUE='1'
		AND PATIENT_NO IN (

		SELECT
			DISTINCT ids.PATIENT_NO
		FROM
			[dbo].[tmp_id] AS ids
			LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
		WHERE
			r.SD_ITEM_CODE = 'YXA_O_151'
			AND r.SD_ITEM_VALUE IN ('1','2','3','4','5','6','7','8','12','15')
			AND ids.PATIENT_NO IN (
		-- 	至少一次随访
			SELECT
				DISTINCT PATIENT_NO
			FROM
				[dbo].[PAT_FOLLOW_UP]
			WHERE
				FOLLOW_UP_DATE != '1900-01-01 00:00:00.000'
				AND FOLLOW_UP_MONTHS!=''
				AND PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
			)
			AND ids.PATIENT_NO NOT IN (
				-- 术前新辅助
				SELECT
					 r.PATIENT_NO
				FROM
					[dbo].[tmp_id] AS ids
					LEFT JOIN [dbo].[PAT_SD_ITEM_RESULT] AS r ON ids.PATIENT_NO=r.PATIENT_NO
				WHERE
					r.SD_ITEM_CODE = 'YXA_O_117'
					AND r.SD_ITEM_VALUE = '1'
			)
			AND ids.PATIENT_NO NOT IN (
				-- 查询围手术期(30天内)死亡的患者
				SELECT
					die.PATIENT_NO
				FROM (
					-- 院内死亡
					SELECT DISTINCT
						a.PATIENT_NO
					FROM
						[dbo].[PAT_SD_ITEM_RESULT] AS a
					WHERE
						a.SD_ITEM_CODE = 'YXA_O_209'
						AND a.SD_ITEM_VALUE= '1'
						AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )

						UNION

					-- 死亡日期 减去 手术日期 小于等于30天
					SELECT DISTINCT
						a.PATIENT_NO
					FROM
						[dbo].[PAT_SD_ITEM_RESULT] AS a
						LEFT JOIN [dbo].[PAT_FOLLOW_UP_RESULT] AS b ON b.SD_ITEM_CODE = 'YXA_O_257' -- 随访死亡日期

						AND b.SD_ITEM_VALUE != ''
					WHERE
						a.SD_ITEM_CODE= 'YXA_O_161' -- 手术日期

						AND a.SD_ITEM_CODE!= ''
						AND b.PATIENT_NO= a.PATIENT_NO
						AND a.PATIENT_NO IN ( SELECT PATIENT_NO FROM [dbo].[PAT_VISIT] WHERE SD_GROUP = '1' AND SD_CODE = 'YXA_O' )
						AND DATEDIFF(
							mm,
							CONVERT ( VARCHAR ( 100 ), a.SD_ITEM_VALUE, 120 ),
							CONVERT ( VARCHAR ( 100 ), b.SD_ITEM_VALUE, 120 )
						) <= '1'
				) AS die
			)
		)
```

从入组（6153）条件里剔除掉复发转移率低于10%的医院后有 4002 病例

死亡的患者有（总）：1492
	0-12 个月死亡的患者有： 863
	0-9 个月死亡的患者有： 585
	0-6 个月死亡的患者有： 303
复发转移的患者有（总）：1685
	0-12 个月复发转移的患者有： 1248
	0-9 个月复发转移的患者有： 991
	0-6 个月复发转移的患者有： 660


## 2020年03月11日统计

入组：
1. 胰腺导管腺癌
2. 手术方式： 1,2,3,4,5,12,6,7,9,15
	YXA_O	SSMC	1	胰十二指肠切除术
	YXA_O	SSMC	2	胰十二指肠切除术（联合门静脉壁切除）
	YXA_O	SSMC	3	胰十二指肠切除术（保留幽门）
	YXA_O	SSMC	4	胰体尾脾切除术
	YXA_O	SSMC	5	胰体尾切除术（保脾）
	YXA_O	SSMC	6	全胰切除术
	YXA_O	SSMC	7	保留十二指肠的胰头肿物切除术
	YXA_O	SSMC	8	胰腺节段切除术
	YXA_O	SSMC	12	根治性顺行模块胰体尾脾切除术
	YXA_O	SSMC	13	探查术
	YXA_O	SSMC	14	活检术
	YXA_O	SSMC	15	胰腺肿物剜除术

3. 至少一次随访
4. 排除围手术期死亡